添付ファイルはアプリ制作案についてgrokと対話したものです。読み込んでください。この内容を前提として、会話を進めます。

思考時間: 29s

読み込みました。内容は、ざっくり言うと「**無料寄りのWeb構成で、動画＋音（ソルフェジオ正弦波）をブラウザ内で合成し、MP4を書き出してDLさせる**」案で、技術軸は **ffmpeg.wasm + Web Audio API +（映像生成なら）Three.js/WebGL**、公開は **Vercel/Netlify/GitHub Pages/Cloudflare Pages** 等の無料ホスティング、アクセス権販売は **MemberSpace** などで“会員限定化”する、という整理ですね。

アプリ制作案質疑応答

この前提で、以後の会話はこう進めるのがスムーズです（こちらで叩き台を作れます）：

- **A:「動画アップ＋エフェクト」型**（ユーザーがMP4を持ち込む）
    
- **B:「映像をゼロ生成」型**（万華鏡/点描/パーティクルをThree.jsで生成 → 録画して動画化）
    
    アプリ制作案質疑応答
    
      
    ※ファイルアップ型より軽くなりやすい、という方向性もファイル内にあります。
    
    アプリ制作案質疑応答
    

さらに「ソルフェジオ6種に合わせて、点描で6テーマ映像を用意する」アイデア（396/417/528/639/741/852の見た目コンセプト）も前提に入ってます。

アプリ制作案質疑応答

---

## まずこちらから着手できます

次のどれを作りたいですか？（番号だけ返してくれてOK）

1. **MVP仕様（画面・操作フロー・入出力・制限：最大分数/解像度/対応形式）**を1枚にまとめる
    
2. **技術設計**：ブラウザ完結の合成フロー（MediaRecorder→ffmpeg.wasm、音声ミックス、書き出し）を具体化する
    
    アプリ制作案質疑応答
    
3. **6種類の映像テーマ**を「実装しやすい順」に並べ替えて、Three.jsの実装方針（Points/Shader/Noise/万華鏡）に落とす
    
    アプリ制作案質疑応答
    
4. **販売・アクセス制御**（MemberSpace/Gumroad/Stripe直）を、あなたの売り方に合わせて最小構成で決める
    
    アプリ制作案質疑応答
    

どれからいきましょう？

情報源

まずはB案で進めることにします。 そして、それらに加えてバイノーラルビートを生成する機能も加えます。目的に合わせて５種類を選べるようにします。 さらにシューマン共振(可聴域にするためにバイノーラルビートを使い、生成)も追加したい。 ・ソルフェジオのみ ・ソルフェジオ＋バイノーラル ・ソルフォジオ＋シューマン共振 この3パターンを選べるようにしたい 動画をどこにあわせて生成するかはソルフェジオが優先となる 完成の形をまず具体的にイメージしたいのだけど、 3が適切かな？それとも別案があれば出して。 先ほど、別のアプリを作ったが、生成物の動画を見ると思ったようなものには程遠いものが出来たので、開発を打ち切った。かなり細部まで作り込んでから内容がダメなのがわかったので、まず、どんな生成物が仕上がるのか具体的にイメージしてから実際の作業にかかりたい。

思考時間: 28s

B案（映像ゼロ生成）で、しかも「**完成物の“見た目”を先に固めたい**」なら、以前の ③（6テーマを実装しやすい順に落とす）だけだとまだ弱いです。  
先にやるべきは **「生成物の見本（ルックブック）を作って“合格ライン”を確定する工程」** です。

## 結論：おすすめの進め方（別案）

### ③の前に「0) 生成物ルックブック（10秒試作×6 + 音3パターン）」を入れる

これが一番、あなたが前回ハマった「作り込んだ後でダメに気づく」を潰せます。

- **0-1：静止画（1枚/テーマ）**  
    まず「色・質感・密度・光り方」を決める。ここで“違う”がすぐ分かる。
    
- **0-2：10秒ループ動画（1本/テーマ）**（9:16 / 1080×1920 / 30fps）  
    “動きの品”が合ってるか確認。ここが勝負。
    
- **0-3：音の3パターン別に差し替え**  
    同じ10秒映像に対して
    
    - ソルフェジオのみ
        
    - ソルフェジオ＋バイノーラル（目的5種）
        
    - ソルフェジオ＋シューマン（7.83Hzをバイノーラルで生成）  
        を当てて、「これで売り物になるか」を先に確定。
        

この“見本セット”がOKになってから、③（実装順）に入るのが安全です。

---

## 「完成の形」を具体イメージできるように、先に決める仕様

### 1) 映像はソルフェジオ優先（あなたの方針に合わせる）

- ユーザーが選ぶのはまず **ソルフェジオ（396/417/528/639/741/852）**
    
- それに紐づく **映像プリセット（テーマ・配色・動き）** が決まる
    
- バイノーラル／シューマンは **音だけ追加**（映像のテーマは変えない）
    

### 2) 音のモードUI（あなたの3パターン）

- **A：ソルフェジオのみ**（単一正弦波 or 軽い倍音追加も可）
    
- **B：ソルフェジオ＋バイノーラル**（目的5種から選択）
    
- **C：ソルフェジオ＋シューマン共振**（7.83Hz差をバイノーラルで生成）
    

---

## バイノーラル「目的5種」の具体案（安全寄り＆分かりやすい）

※医療効果は言わず「気分・作業モード」程度の表現に留める想定

1. **Sleep**：差 3.5 Hz（ゆっくり沈む）
    
2. **Meditation**：差 6.0 Hz（内側に落ち着く）
    
3. **Relax**：差 10.0 Hz（ゆるめて整える）
    
4. **Focus**：差 16.0 Hz（作業モード）
    
5. **Peak**：差 40.0 Hz（シャキッと）
    

作り方はシンプルで、左右の搬送波（例：200Hz）をずらすだけです。  
例：差6Hzなら L=200Hz / R=206Hz。

### シューマン共振（7.83Hz）

- **差を 7.83 Hz** に固定  
    例：L=200Hz / R=207.83Hz（あるいは 210 / 217.83 など）
    
- 音量はかなり小さめ（-20dB〜-30dB相当）で混ぜる想定が扱いやすいです。
    

---

## 「6テーマ映像」を“実装前に想像できる”形で書く（例）

ここはあなたのブランドに寄せた“生成物イメージの言語化”です。  
（実装は後で良い。まずは見た目の合否を決める）

- **396Hz（グラウンディング）**  
    暗めの赤〜黒、粒子が下に沈む／中心が重い。光は控えめで“静かな熱”。
    
- **417Hz（解放・刷新）**  
    琥珀〜橙、螺旋のほどけ／リセット波。ノイズが一瞬ほどけて透明になる瞬間がある。
    
- **528Hz（コアの修復）**  
    緑〜金、中心核が脈打つ。粒子が“集まって整列”する感じ。発光は澄んでいて強すぎない。
    
- **639Hz（調和・つながり）**  
    ピンク〜ローズ、2つの流れが寄って混ざる。境界が柔らかく、角がない。
    
- **741Hz（浄化・クリア）**  
    青〜シアン、霧が晴れる／線がシャープに立つ。透明感とキラつき。
    
- **852Hz（直感・高域）**  
    紫〜白、上に昇る粒子／星屑。密度は少なめ、余白が美しい。
    

重要：映像は「396Hzで396回点滅」みたいな同期はしない。  
**“テーマ・速度・密度・発光の仕方”** をソルフェジオに紐づける方が、完成物が綺麗になりやすいです。

---

## あなたの不安（作り込んでからダメ）を潰す“ゲート”

MVPでも必ず入れると良いです。

- **プレビュー10秒を生成 → OKなら書き出し**
    
- プレビューが「程遠い」と感じたら、**映像プリセット（色/密度/発光/動き）だけ**直す  
    → “ffmpeg書き出し地獄”に入らない
    

---

## 次にやるべきこと

あなたの目的は「完成物の具体イメージ」なので、次は **0) ルックブック** が最適です。

ここから先、私の方で **“合格ラインを固定するためのチェックリスト”**（例えば「粒子密度は多い/少ない」「発光は強い/弱い」「万華鏡感は要/不要」など）を作って、6テーマの見本仕様を1枚にまとめます。  
それを基準に「10秒試作の出来」を判定できる形にします。

この方向で、まず **6テーマの“合格条件”チェック項目** を作っていきます（実装に入らず、完成物のイメージ固めに全振り）。

それで行きましょう。続けて

了解。ここからは **「合格ライン（完成物イメージ）」を固定するためのルックブック設計**に全振りします。  
実装は一切考えず、まず“何が出力されたらOKか”だけ決めます。

---

## 0) ルックブックのゴール（作る見本一式）

**各ソルフェジオ（6種）× 10秒ループ動画 ＝ 6本**  
それぞれに音を差し替えて **3モードの完成形が想像できる**状態にします。

- 映像：9:16 / 1080×1920 / 30fps / 10秒 / ループ前提
    
- 音：  
    A) ソルフェジオのみ  
    B) ソルフェジオ＋バイノーラル（目的5種）  
    C) ソルフェジオ＋シューマン（差 7.83Hz）
    

※映像はソルフェジオが優先。音のモードで映像テーマは変えない。

---

## 1) 合格条件チェックリスト（全テーマ共通）

「良い／ダメ」が即判断できるように、項目を **YES/NO** に落とします。

### 1-1. “売り物としての品”

-  **安っぽいゲームUI感がない**（チカチカ・原色・過剰なコントラストが出てない）
    
-  **ループが自然**（10秒の終点で“切れ目”が分からない）
    
-  **情報量が適正**（見続けて疲れない／でも退屈すぎない）
    
-  **スマホ画面で成立**（小さく見ても “綺麗” が残る）
    
-  **圧縮後も崩れない**（細かすぎる線・モアレが主役になってない）
    

### 1-2. “ヒーリング映像としての快適さ”

-  **点滅（フラッシュ）が主役にならない**（刺激が強すぎない）
    
-  **動きが急に加速しない**（落ち着きがある）
    
-  **中心/視線誘導が暴れない**（目が迷子にならない）
    
-  **暗転が頻繁に起きない**（安心して見ていられる）
    

### 1-3. “ブランドらしさ”

-  **“神秘・透明感・浄化” の方向に寄っている**
    
-  **俗っぽい派手さではなく、奥行きのある光**
    
-  **テーマごとに雰囲気が明確に違う**（6種の買い分け理由になる）
    

---

## 2) 映像プリセットの“決めるべき8パラメータ”

これを固定すると、完成物がブレなくなります。  
各テーマごとに **0〜5** で決めてしまう方式にします。

1. **明るさ**（暗い0 ←→ 5 明るい）
    
2. **コントラスト**（低0 ←→ 5 高）
    
3. **粒子密度**（少0 ←→ 5 多）
    
4. **発光の強さ**（控えめ0 ←→ 5 強）
    
5. **動きの速さ**（遅0 ←→ 5 速）
    
6. **揺らぎの量**（静0 ←→ 5 うねる）
    
7. **対称性**（無0 ←→ 5 万華鏡級）
    
8. **奥行き感**（平面0 ←→ 5 深い）
    

> ここまでが「仕様」。この8つが決まれば、どんな実装でも“同じ完成物”に寄せられます。

---

## 3) 6テーマの“合格プロファイル”（叩き台）

あなたの世界観（透明感・神秘・整う）に寄せて、まず仮置きします。

### 396Hz：Ground（重さ・沈む・守り）

- 明るさ 1 / コントラスト 3 / 粒子 4 / 発光 1 / 速さ 1 / 揺らぎ 2 / 対称 1 / 奥行き 4
    
- 合格の一言：**「静かな熱。下に落ちて“定着”する」**
    

### 417Hz：Reset（ほどける・流れる・刷新）

- 明るさ 2 / コントラスト 3 / 粒子 3 / 発光 2 / 速さ 2 / 揺らぎ 4 / 対称 2 / 奥行き 3
    
- 合格の一言：**「絡みが解けて、透明に戻る瞬間がある」**
    

### 528Hz：Repair（集まる・整列・核）

- 明るさ 3 / コントラスト 2 / 粒子 3 / 発光 3 / 速さ 2 / 揺らぎ 2 / 対称 3 / 奥行き 4
    
- 合格の一言：**「中心核が育ち、散ったものが“揃う”」**
    

### 639Hz：Harmony（混ざる・柔らぐ・つながる）

- 明るさ 3 / コントラスト 2 / 粒子 2 / 発光 2 / 速さ 2 / 揺らぎ 3 / 対称 2 / 奥行き 3
    
- 合格の一言：**「境界が丸くなって、2つが自然に溶け合う」**
    

### 741Hz：Clear（晴れる・削ぎ落ちる・澄む）

- 明るさ 4 / コントラスト 3 / 粒子 2 / 発光 3 / 速さ 3 / 揺らぎ 2 / 対称 2 / 奥行き 3
    
- 合格の一言：**「霧が抜けて、線が立つ。透明感が主役」**
    

### 852Hz：Intuition（上がる・余白・星屑）

- 明るさ 4 / コントラスト 2 / 粒子 1 / 発光 4 / 速さ 2 / 揺らぎ 3 / 対称 1 / 奥行き 5
    
- 合格の一言：**「余白が美しい。上に昇り、遠くが光る」**
    

---

## 4) 音の“合格条件”（3モード共通）

### A) ソルフェジオのみ

-  低すぎて聴こえない問題がない（音量の基準が安定）
    
-  耳に刺さらない（倍音・高域が暴れない）
    
-  無音に聞こえる瞬間がない（一定の存在感）
    

### B) ソルフェジオ＋バイノーラル（目的5種）

-  バイノーラルは**“効かせに行く”より“邪魔しない”**（主役はソルフェジオ）
    
-  イヤホン前提の注意書きが必要なレベルの成分は控えめ
    
-  目的差が「説明できる程度に」感じられる（Sleep/Focus等のキャラが立つ）
    

### C) ソルフェジオ＋シューマン（差 7.83Hz）

-  “いる/いない” が分かるが、気持ち悪くならない
    
-  うねり（ビート）が大きすぎない（混ぜすぎ注意）
    
-  長時間でも疲れない（強調しない）
    

---

## 5) ルックブック制作の手順（これで判断が早い）

1. まず **396/528/852 の3本だけ**10秒ループ見本を作る（振れ幅が大きい代表）
    
2. その3本で **共通チェックリスト**に○×をつける
    
3. ○×が揃ったら、残り3本（417/639/741）へ拡張
    
4. 6本揃ったら、音を3モード差し替えて「商品として成立」を最終判断
    

> ここで“成立”してから、実装（Three.js/Shader等）に進む。

---

## 次の出力（こちらで作る）

このまま進めるので、次に **「ルックブック台本」**を作ります。

- 各テーマごとに
    
    - 画の説明（1〜2行）
        
    - 禁止事項（やると安っぽくなる）
        
    - 10秒内の動き設計（開始→中盤→終盤→ループ）  
        を文章で固定した“台本”にします。
        

続けて、まず **396Hz / 528Hz / 852Hz の台本**をこちらで出します。

OK。続けて

了解。では **ルックブック台本 v1** として、まず **396 / 528 / 852 の10秒ループ設計**を“文章で固定”します。  
（ここでOKが出たら、残り3本も同じフォーマットで量産できます）

---

# ルックブック台本 v1（10秒ループ）

共通仕様：9:16 / 1080×1920 / 30fps / 10s / ループ前提

## 396Hz｜Ground（重さ・沈む・定着）

### 画の一言（合格イメージ）

**「静かな熱。粒子が“下へ沈んで”定着していく」**

### 色・質感（固定）

- ベース：深い赤〜黒（暗め）
    
- 光：鈍い朱〜暗い金（“テカり”ではなく“内側の熱”）
    
- 質感：霧＋微粒子（粒子は小さめ、細かすぎない）
    

### 構図（固定）

- **重心は下**（画面下1/3に密度が集まる）
    
- 中心は安定（左右に振れない）
    
- 奥行きは深め（遠景に薄い層を残す）
    

### 動き設計（0〜10秒）

- **0–2s：沈降開始**  
    上側に薄い粒子、下へゆっくり落ち始める。発光は控えめ。
    
- **2–6s：定着ゾーン形成**  
    下1/3に“層”ができる。粒子が溜まるほど動きはさらに遅くなる。
    
- **6–9s：わずかな呼吸**  
    下の層が「1回だけ」静かに膨らむ（脈動は1回でOK。多いと安っぽい）
    
- **9–10s：ループ接続**  
    最後の1秒で状態が“初期と同じ配置”に戻る（溜まり具合の差が出ないように）
    

### ループのコツ（台本として固定）

- 10秒間で **「増える/減る」** を起こさない（溜まり続けるとループがバレる）
    
- “沈む”はやるが、総量は一定に見せる（出現と消失を裏で均衡）
    

### 禁止（これをやると一発で安っぽい）

- 点滅（フラッシュ）を主役にする
    
- 赤を鮮やかにしすぎる（原色っぽさ）
    
- ランダムに暴れる粒子（視線が落ち着かない）
    

### 合格チェック（YES/NO）

-  画面下に“安心する重さ”がある
    
-  10秒見続けても疲れない
    
-  ループが分からない
    

---

## 528Hz｜Repair（集まる・整列・核）

### 画の一言（合格イメージ）

**「中心核が育って、散った粒子が“揃って整列”していく」**

### 色・質感（固定）

- ベース：深緑〜エメラルド（暗すぎない）
    
- 光：金〜黄緑（透明で澄んだ光。白飛びさせない）
    
- 質感：**粒子＋薄い光膜**（膜は“柔らかいガラス”っぽく）
    

### 構図（固定）

- **中心核**：画面中央やや下（下寄りにすると落ち着く）
    
- 中心から外へ“整う波”が広がる（放射だけど攻撃的にしない）
    
- 奥行きは深め（遠景に点が少しだけ残る）
    

### 動き設計（0〜10秒）

- **0–2s：散っている状態**  
    粒子はバラけているが、全体の回転は遅い。核はまだ弱い。
    
- **2–5s：中心へ引き寄せ**  
    粒子が中心へ“寄る”。このときスピードは上げない（自然に）
    
- **5–7s：整列（揃う瞬間）**  
    粒子の動きが「バラバラ → 同じ方向」へ揃う。  
    ※ここが528の“気持ちよさ”のピーク。派手な演出は不要。
    
- **7–9s：核の発光が少し強まる**  
    ただし **強めすぎない**（キラキラ増やすとチープ）
    
- **9–10s：初期状態へ戻す**  
    整い切ったまま終わらず、最後の1秒で少し散らして “0秒に戻る”
    

### ループのコツ（固定）

- 10秒で「整う→少し散る」までやる  
    （整うだけだと、ループで“増え続ける”感じが出る）
    

### 禁止

- コントラスト強すぎ（SFっぽくなる）
    
- “核が爆発する”演出（ヒーリングからズレる）
    
- 小さすぎる細線・過密ディテール（圧縮で崩れる）
    

### 合格チェック

-  “整う”が目で分かる（説明できる）
    
-  透明で澄んだ発光（テカりではない）
    
-  ループしても進行している感じが出ない
    

---

## 852Hz｜Intuition（上がる・余白・星屑）

### 画の一言（合格イメージ）

**「余白が美しい。星屑が上に昇って、遠くが光る」**

### 色・質感（固定）

- ベース：紫〜紺（暗いが潰さない）
    
- 光：白〜淡い紫（発光は強めOK。ただし“粒”は少なめ）
    
- 質感：星屑＋薄いオーロラ膜（膜は“遠景”だけ）
    

### 構図（固定）

- 粒子密度は **少なめ**（余白が主役）
    
- 上方向への流れ（“昇る”方向が一貫）
    
- 奥行き最大（遠景の点が「深さ」を作る）
    

### 動き設計（0〜10秒）

- **0–3s：星屑がゆっくり上昇**  
    速度は一定。加速しない。
    
- **3–6s：遠景の膜が一度だけ揺れる**  
    オーロラ膜が“呼吸”する（1回だけ）
    
- **6–8.5s：一瞬だけ“静けさ”が増す**  
    粒子が少し減ったように見える（実際に減らさず、目立たなくする）
    
- **8.5–10s：初期配置へ戻す**  
    粒子が上に抜けていくと総量が変わるので、最後で“戻し”を入れる
    

### ループのコツ（固定）

- 上に流すだけだと、ループで“流れの切れ目”がバレやすい  
    → **粒子は循環**（上へ行ったものが遠景で回り込み、下に薄く戻る）
    

### 禁止

- 星が大量（賑やかでチープ）
    
- キラキラ点滅（刺激が強い）
    
- 紫を鮮やかにしすぎ（ギャルっぽい紫になる）
    

### 合格チェック

-  余白が美しい（見ていて呼吸が深くなる）
    
-  “上へ昇る”が一貫している
    
-  ループが分からない
    

---

# 音の差し替え台本（この3本に共通で適用）

映像は固定。音だけ3モードを切り替える。

## モードA：ソルフェジオのみ

- 396/528/852 を主役（正弦波中心、耳に刺さる倍音は増やさない）
    
- 音量の合格：**小さくしても存在感が残る**（無音に感じない）
    

## モードB：ソルフェジオ＋バイノーラル（目的5種）

- バイノーラルは **“背景”**（主役はソルフェジオ）
    
- 合格条件：目的を変えても“邪魔にならない”、でも“雰囲気の違いは説明できる”
    

（目的5種のキャラだけ、台本として固定）

- Sleep：沈む・丸い
    
- Meditation：内側に落ち着く
    
- Relax：緊張がほどける
    
- Focus：輪郭が少し立つ
    
- Peak：軽く冴える（やりすぎない）
    

## モードC：ソルフェジオ＋シューマン（7.83Hz差）

- 7.83Hzは**感じるが主張しない**（混ぜすぎ禁止）
    
- 合格条件：長く聴いても気持ち悪くならない／“揺れ”が大きすぎない
    

---

ここまでが「完成物イメージの固定」です。  
次は、この台本をさらに強固にするために **“比較基準”**を作ります。

## 次に出すもの（続き）

1. 各テーマの **「NG例」**（こうなるとダメ、を具体化）
    
2. 3本それぞれの **“ちょうどいい参考ムード”**（例：映画っぽい、ガラスっぽい、粒子密度などを短文で）
    
3. 残りの **417 / 639 / 741 の台本**（同フォーマットで）
    

このまま続けて、次は **NG例（396/528/852）** から出します。

はい

了解。では続きとして **NG例（ダメになりやすい生成物の具体像）** と、判断を早くするための **参考ムード（短文の“寄せ先”）** を出します。  
そのあと、勢いで **417 / 639 / 741 の台本** まで一気に揃えます。

---

# 396 / 528 / 852 のNG例（これが出たら即リテイク）

## 396Hz｜Ground

### NG1：赤が鮮やかすぎて“警告灯”

- 真っ赤・原色・高コントラスト  
    → **落ち着きより刺激が勝つ**（ヒーリングから離れる）
    

### NG2：粒子がランダム暴走（砂嵐／虫の群れ）

- 速度ムラ、方向ムラ、急な跳ね  
    → 視線が定まらず **不安** を誘発
    

### NG3：沈むはずが“渦巻きショー”

- 回転が主役、エフェクトが派手  
    → “重さ”が消えて **演出感** が出る
    

### NG4：暗すぎてただの黒

- 情報が消える、潰れる  
    → “深さ”ではなく **見えない** になる
    

---

## 528Hz｜Repair

### NG1：核が“爆発”する（SF演出）

- 発光が急増、衝撃波っぽい広がり  
    → 修復ではなく **攻撃/イベント** になる
    

### NG2：整列が“機械的すぎる”

- グリッドに吸着、規則正しすぎる動き  
    → 温かみが消え、**冷たいデモ映像** になる
    

### NG3：キラキラを盛りすぎて“安物ジュエリー”

- ハイライト点滅、スパークル過多  
    → 品が落ちる（チープ）
    

### NG4：細線・微細パターンだらけで圧縮崩壊

- モアレ、チラつき、潰れ  
    → 書き出し後に **別物** になる
    

---

## 852Hz｜Intuition

### NG1：星が多すぎて“クリスマス”

- 密度過多、賑やか  
    → 余白が死ぬ（高域の静けさが消える）
    

### NG2：点滅で“覚醒っぽさ”を出しすぎ

- フラッシュ、ストロボ  
    → 刺激が強く、長時間視聴に不向き
    

### NG3：紫が鮮やかすぎて“ネオン”

- 派手・俗っぽい  
    → 神秘ではなく **クラブ感** が出る
    

### NG4：上昇だけで粒が抜け続け、ループがバレる

- 10秒後の総量が変わる  
    → ループの切れ目が見える
    

---

# 参考ムード（短文の“寄せ先”）

※「これに近い」って言える指標。実装に関係なく使えます。

- **396Hz**：湿った洞窟の奥で、赤い炭が静かに熱を持つ
    
- **528Hz**：濁りが澄んで、散ったものが“自然に揃う”
    
- **852Hz**：夜空の遠景が深く、星屑は少なく、空気が澄む
    

---

# ルックブック台本 v1（残り3本：417 / 639 / 741）

共通仕様：9:16 / 1080×1920 / 30fps / 10s / ループ

## 417Hz｜Reset（ほどける・刷新・切り替え）

### 画の一言

**「絡みがほどけて、透明に戻る」**

### 色・質感（固定）

- ベース：琥珀〜淡い橙（温かいが派手にしない）
    
- 光：薄い金（白飛び禁止）
    
- 質感：霧＋糸状の流れ（糸は細すぎない）
    

### 構図（固定）

- 中心は“ほどける起点”として安定
    
- 画面全体に流れはあるが、視線は迷わない
    

### 動き設計（0〜10s）

- 0–2s：軽い“絡み”がある状態（もつれの気配）
    
- 2–6s：糸がほどけ、流れが滑らかになる（加速しない）
    
- 6–8.5s：一瞬だけ透明感が増す（霧が薄くなる）
    
- 8.5–10s：少しだけ“絡み”を戻して初期へ接続（戻し必須）
    

### 禁止

- ほどける＝派手に散る（破裂表現）
    
- オレンジが鮮やかすぎる（安っぽい）
    

---

## 639Hz｜Harmony（溶け合う・調和・やわらかさ）

### 画の一言

**「境界が丸くなって、ふたつが自然に混ざる」**

### 色・質感（固定）

- ベース：ローズ〜淡いピンク（甘くしすぎない）
    
- 光：乳白のピンク（柔らかい発光）
    
- 質感：薄い霞＋大きめの柔粒（“ふわっ”と）
    

### 構図（固定）

- 2つの流れ（左右 or 上下）を用意し、中央で混ざる
    
- 対称性は中程度（万華鏡にしない）
    

### 動き設計（0〜10s）

- 0–3s：2つの流れが別々に存在（距離がある）
    
- 3–7s：中央で混ざり、境界が消える（ゆっくり）
    
- 7–9s：混ざった状態で“呼吸”1回（膨らむ→戻る）
    
- 9–10s：境界をほんの少し復活させ初期へ戻す（戻し）
    

### 禁止

- ハート・記号っぽい表現（俗）
    
- ピンクの強発光（チープ）
    

---

## 741Hz｜Clear（晴れる・削ぎ落ちる・クリア）

### 画の一言

**「霧が抜けて、輪郭が立つ。透明感が主役」**

### 色・質感（固定）

- ベース：青〜シアン（冷たいが痛くしない）
    
- 光：透明な白（硬すぎない）
    
- 質感：霧が薄くなる／細かい粒は少なめ
    

### 構図（固定）

- 中心は静かに固定
    
- 画面奥に“澄んだ層”を残す（奥行き）
    

### 動き設計（0〜10s）

- 0–2.5s：薄い霧がある（少し曇る）
    
- 2.5–6s：霧が引いていく（“晴れる”が分かる）
    
- 6–8s：線や粒の輪郭が少しだけシャープに（やりすぎない）
    
- 8–10s：霧をほんの少し戻して初期へ接続（戻し）
    

### 禁止

- 青の高コントラスト化（冷たすぎて刺さる）
    
- シャープにしすぎて“テックデモ”になる
    

---

# 次のステップ（最短で“合格”を決める運用）

1. まず **396/528/852/741** の4本で10秒試作（振れ幅＆事故が出やすい）
    
2. 上の **NG例に該当したら即修正**（作り込み禁止）
    
3. 合格したら 417/639 を追加して6本完成
    

---

次は、さらに判断を爆速にするために **「各テーマの“OK例の条件を3行に圧縮したカード”」** を作ります（SNS投稿みたいに短い言い切りで、制作中にブレないやつ）。  
そのまま続けます。

はい

思考時間: 11s

了解。では制作中に迷わないように、**各テーマの「OK例条件を3行に圧縮したカード」**を作ります。  
（これが“合格ライン”の最小単位になります）

---

# ルックブック「OKカード」6枚（3行で言い切り）

※全部 **10秒ループで成立** が前提  
※映像のテーマは **ソルフェジオ優先**（音モードA/B/Cは上乗せ）

## 396Hz｜Ground

- **下に重心**：画面下1/3に“安心する重さ”、上は薄い霧。
    
- **沈むが増えない**：沈降はするが総量は一定、ループで溜まり続けない。
    
- **刺激ゼロ**：点滅なし／原色赤なし／暴れる粒子なし。
    

## 417Hz｜Reset

- **ほどける**：もつれ→滑らかへ“ほどける変化”が目で分かる。
    
- **透明が一度だけ増す**：6〜8秒付近で「澄む瞬間」が1回。
    
- **散らさない**：破裂・加速・派手演出は禁止（優しくリセット）。
    

## 528Hz｜Repair

- **集まって揃う**：散った粒子が中心へ寄り、動きが“同方向に揃う”。
    
- **核は澄んだ光**：発光は透明・白飛びなし、爆発演出なし。
    
- **整う→少し戻す**：整い切ったまま終わらず、最後で軽く散らしてループ接続。
    

## 639Hz｜Harmony

- **二つが混ざる**：別々の流れが中央で溶け、境界が丸くなる。
    
- **ふわっと柔らかい**：密度は中〜少、角のある粒・硬い光は避ける。
    
- **甘さにしない**：記号っぽさ（ハート感）やピンク強発光はNG。
    

## 741Hz｜Clear

- **霧が抜ける**：曇り→晴れが分かる（霧が薄くなるのが主役）。
    
- **輪郭が“少しだけ”立つ**：シャープ化は控えめ、テックデモ化しない。
    
- **冷たすぎない**：青の高コントラスト・刺さる白は避け、透明感で勝負。
    

## 852Hz｜Intuition

- **余白が美しい**：粒子は少なめ、賑やかにしない。
    
- **上に昇る一貫性**：上昇の方向性がブレない／加速しない。
    
- **星は“少量高品位”**：点滅キラキラNG、奥行きで神秘を出す。
    

---

# 1分で判定できる「合否ルール」

試作が出たら、各テーマについてこれをやります。

## ① 共通チェック（各テーマ共通：8項目）

- ループが自然（切れ目が分からない）
    
- 点滅が主役になってない
    
- 10秒見て疲れない
    
- スマホ縮小でも綺麗
    
- 圧縮でモアレが出てない
    
- 色が原色っぽくない
    
- 動きに急加速がない
    
- 視線が迷子にならない（中心/重心が安定）
    

**判定**：

- ✅ 6/8以上 → テーマ合格（次へ）
    
- ⚠️ 5/8 → “軽微修正”（色・密度・速度のどれか1つだけ触る）
    
- ❌ 4/8以下 → “作り直し”（演出設計がズレてる）
    

## ② テーマ固有チェック（OKカードの3行）

各テーマのOKカード3行のうち **2行以上YES** なら合格。

---

# 音モード（A/B/C）の“合格カード”（短縮版）

映像は固定。音だけ差し替え。

## A：ソルフェジオのみ

- 小さくしても存在感が残る（無音っぽくならない）
    
- 刺さらない（倍音・高域を盛らない）
    

## B：ソルフェジオ＋バイノーラル（目的5種）

- 主役はソルフェジオ、バイノーラルは背景
    
- 目的を変えても不快にならず、説明できる程度に差がある
    

## C：ソルフェジオ＋シューマン（7.83Hz差）

- “いる/いない”は分かるが主張しない（混ぜすぎない）
    
- うねりが大きすぎず、長時間でも気持ち悪くならない
    

---

# 次にやること（この順で事故が減る）

1. **396 / 528 / 852 / 741** の4本だけ、10秒試作
    
2. 上の **合否ルール**で機械的に判定
    
3. 合格したテーマだけ、残り **417 / 639** を追加
    
4. 6本揃ったら、音をA/B/Cで差し替えて最終判断
    

---

この次は、さらに“イメージのズレ”を減らすために、各テーマにつき **「スライダー調整の優先順位（最初に触る1つだけ）」** を決めます。  
例：396なら「粒子密度」、852なら「粒子量（余白）」みたいに、迷いを潰すやつです。

続けて、それを出します。

はい

了解。では **「迷ったら最初に触るスライダーはこれ」** をテーマごとに1本ずつ固定します。  
（＝修正が“1手”で済むようにするルール）

---

# 各テーマ：最初に触るスライダー（最優先1つ）

## 396Hz｜Ground

**粒子密度（下1/3の密度）**

- NGになりやすいのは「軽い」「落ち着かない」→ 密度で“重さ”が戻る
    

## 417Hz｜Reset

**揺らぎ量（うねり/ほどけの強さ）**

- NGは「派手」「散る」→ 揺らぎを下げると“優しいリセット”に戻る
    

## 528Hz｜Repair

**中心核の強さ（核の発光/引力の強さ）**

- NGは「SF」「爆発」or「整わない」→ 核の強さを少しだけ調整するのが最短
    

## 639Hz｜Harmony

**境界の柔らかさ（ブレンド幅）**

- NGは「混ざらない」「甘すぎる」→ 境界の“溶け具合”で一発修正できる
    

## 741Hz｜Clear

**霧の量（ヘイズ量）**

- NGは「ただの青」「テックっぽい」→ 霧を“少し残す/少し引く”で透明感が出る
    

## 852Hz｜Intuition

**粒子量（余白）**

- NGは「賑やか」「星だらけ」→ 粒子を減らすだけで一気に“高級”になる
    

---

# 2番目に触るスライダー（補助1つ）

※最優先で直らなかったときだけ

- 396：**動き速度**（遅くすると“定着”に寄る）
    
- 417：**コントラスト**（弱めると“上品”に戻る）
    
- 528：**粒子の整列度**（揃いが弱い/強すぎるを調整）
    
- 639：**粒子密度**（多いと甘く、少ないと薄い）
    
- 741：**輪郭シャープ量**（上げすぎるとテック化）
    
- 852：**奥行き感**（深くすると“神秘”、浅いと“平面”）
    

---

# 音モードの「最初に触るスライダー」（迷い防止）

## A：ソルフェジオのみ

**音量（基準レベル）**

- 小さすぎると“無音”、大きすぎると“疲れ”になる。まずここ。
    

## B：ソルフェジオ＋バイノーラル

**バイノーラル混ぜ量**

- 効かせに行くほど事故るので、最初は“薄く”が正解。
    

## C：ソルフェジオ＋シューマン（7.83Hz）

**シューマン混ぜ量（=差7.83成分の音量）**

- うねりが出たら入れすぎ。まず下げる。
    

---

# “1手修正ルール”（重要）

試作がダメだったら **最優先スライダーだけ** 動かして再試作。  
2つ以上いじらない。沼らない。

---

次は、いよいよ **「ルックブック用のUI（ユーザーが触る操作）」** を文章で確定します。  
具体的には、

- ① ソルフェジオ選択（6）
    
- ② 音モード（3）→（バイノーラル目的5 or シューマン固定）
    
- ③ 映像プリセット（テーマ内の“強さ”だけ1本スライダー）
    
- ④ 10秒プレビュー生成 → OKなら本書き出し
    

この形で、画面構成（1画面か2画面か）まで固めます。続けます。

はい

了解。では **ルックブック前提のUI（画面構成と操作）** を先に“確定仕様”として書きます。  
目的は「10秒プレビューで合否を出し、OKなら書き出す」こと。沼らない設計にします。

---

# UI案：最適は「1画面完結 + 10秒プレビューゲート」

前回の失敗（作り込んでからダメ）を避けるなら、画面を分けない方がいいです。  
**触る→10秒生成→判定→OKなら書き出し** が一直線になります。

---

## 画面レイアウト（1画面）

### A. プレビュー領域（上 60%）

- 9:16の縦プレビュー（中央）
    
- 左上に小さく状態表示：`Preview 10s / 1080×1920 / 30fps`
    
- 右上に「ループON」固定（OFFは作らない）
    

### B. コントロール領域（下 40%）

#### 1) ソルフェジオ（最優先・必須）

- 6つのボタン：**396 / 417 / 528 / 639 / 741 / 852**
    
- 選んだ瞬間、下にテーマ名が表示（Ground/Reset…）
    

#### 2) 音モード（3パターン）

- ラジオボタン：
    
    - **A：ソルフェジオのみ**
        
    - **B：ソルフェジオ＋バイノーラル**
        
    - **C：ソルフェジオ＋シューマン（7.83Hz）**
        

#### 3) モード別の追加選択（条件表示）

- Bを選んだ時だけ表示：**目的（5種）**
    
    - Sleep / Meditation / Relax / Focus / Peak
        
- Cは追加選択なし（固定）
    

#### 4) “沼らない”スライダー（2本まで）

- **映像：Theme Strength（0〜100）**  
    テーマごとの「最優先スライダー」を内部で動かす（ユーザーには1本に見せる）
    
    - 396 → 粒子密度
        
    - 417 → 揺らぎ量
        
    - 528 → 中心核の強さ
        
    - 639 → 境界の柔らかさ
        
    - 741 → 霧の量
        
    - 852 → 粒子量（余白）
        
- **音：Mix Strength（0〜100）**（モードB/Cの時だけ表示）  
    バイノーラル／シューマンの混ぜ量をコントロール（事故防止）
    

> ここがポイント：スライダーは最大2本。  
> 「映像1本」「音1本」だけにして、調整迷子を封じます。

#### 5) アクションボタン（2つだけ）

- **Generate Preview (10s)** ←まず必ずここ
    
- **Export Full**（分数選択後に実行。プレビューが未生成なら押せない）
    

---

# フロー（ユーザーの操作導線）

1. ソルフェジオを選ぶ
    
2. 音モードを選ぶ（必要なら目的も選ぶ）
    
3. スライダーは触っても触らなくてもOK
    
4. **Generate Preview (10s)**
    
5. プレビューが良ければ **Export Full**（15s/30s/60s/3min…）
    

---

# 「合否判定」をUIに埋め込む（超重要）

プレビューの下に、あなたが作った **OKカード（3行）** を自動表示します。

例：396を選ぶと、プレビュー下にこう出る：

- 下に重心：下1/3に安心する重さ
    
- 沈むが増えない：総量一定でループ
    
- 刺激ゼロ：点滅/原色/暴走なし
    

さらに右側にチェックボックス（任意）：

-  YES [ ] YES [ ] YES
    

これでユーザー（あなた）が **主観を言語化して評価**できます。  
「なんか違う」で終わらない。

---

# “事故を防ぐ”固定仕様（開発前に決める）

- プレビューは **常に10秒固定**（長さを選ばせない）
    
- プレビュー生成は **必ず軽い設定**（最終書き出しと分ける）
    
- Exportは **プレビュー合格後**（未生成ならボタン無効）
    
- 初期値は安全側：
    
    - Theme Strength：中（50）
        
    - Mix Strength：低（20）←特にシューマンは薄めが正解
        
- いつでも「Reset to Default」1発（迷ったら戻れる）
    

---

# もう1案（2画面案）は“今回は非推奨”

2画面（設定→プレビュー/書き出し）にすると、  
「設定をいじる時間」が増えて、前回と同じ沼が起きやすいです。  
あなたの目的（完成物イメージ固定）には、**1画面＋ゲート**が最適。

---

## 次に固めるべきもの（UIの次の一手）

ここまでで「完成物イメージ」「評価方法」「UI導線」が決まりました。  
次は **“出力物の最低ライン（商品としての型）”** を決めます。

- エクスポートの解像度（まず1080×1920固定で良いか）
    
- 書き出し時間のプリセット（15/30/60/180秒など）
    
- 音量の基準（LUFS的な話をせず、体感で一定にするルール）
    

この3点を確定すると、仕様が実務レベルに落ちます。  
続けてそれを出します。

ユーザーが既存の音源(ヒーリング音楽など)のmp3をアップロードし、それにミックスする形でソルフェジオなどを鳴らします。ミックスの際のmp3とのバランス調整が出来るようにしてください。

OK。**「ユーザーのMP3（ヒーリング音楽）をアップロード → それを土台にソルフェジオ/バイノーラル/シューマンを重ねる」** 前提で、UIと合格ラインを更新します。  
ポイントは **“バランス調整が必ずできる”** ことと、**プレビュー10秒で音も判定できる** こと。

---

## UI追加：Audio（MP3）セクションを入れる

### 1) MP3アップロード（必須オプション）

- ボタン：**Upload MP3**
    
- 表示：ファイル名 / 長さ / 波形（簡易でOK）/ 再生ボタン
    
- チェック：未アップロードでも動く（＝音源なしで生成も可能）  
    ただし今回は「土台MP3ありがメイン」なので、UI上は目立たせる
    

### 2) ミキサー（重要：最低3本スライダー）

ここは沼らない範囲で “必要十分” を切ります。

- **MP3 Volume（0–100）** ←土台
    
- **Tone Volume（0–100）** ←ソルフェジオ（必ず分離）
    
- **Extra Volume（0–100）** ←バイノーラル or シューマン（モードB/Cの時だけ表示）
    
- できれば追加で
    
    - **Master（0–100）**（全体の最終音量）
        
    - **Tone Ducking（0–100）**（MP3が鳴ってる時だけトーンを少し引っ込める）※任意だけど事故が激減
        

> 「Mix Strength 1本」だと、**MP3とトーンの関係**が調整しづらいので、ここは分けた方が正解です。

---

## 音の合格ルール（プレビュー10秒で判定できる形）

プレビュー再生中に、次の3つが成立してれば合格。

### A) MP3が主役として聴ける

- 音楽の芯が消えない（トーンで覆わない）
    

### B) トーンが“いる”のは分かるが邪魔しない

- うるさくない／耳に刺さらない
    
- 「入ってる感」がないと商品価値が落ちるので、ゼロにしすぎない
    

### C) Extra（バイノーラル/シューマン）が不快を起こさない

- うねりが強すぎない
    
- イヤホン前提注意（バイノーラル）をUIに表示（小さくでOK）
    

---

## 10秒プレビューの作り方（体験としての仕様）

MP3は長尺が多いので、ここを決めておくとユーザーが迷いません。

### プレビュー区間の選び方（2択だけ）

- **Auto（おすすめ）**：MP3の **中盤（例：30%地点）** を10秒切り出し
    
- **Pick（任意）**：簡易スライダーで **開始位置** を選べる（mm:ss）
    

※「ループON」前提なら、10秒区間も自然につながる部分が選ばれやすいのがAuto。

---

## 初期値（事故が少ない安全なデフォルト）

- MP3 Volume：**70**
    
- Tone Volume：**25**
    
- Extra Volume：**10**（B/Cのみ）
    
- Master：**70**
    
- Tone Ducking：**20**（あれば）
    

> これで「音楽が消える」「うねりがうるさい」をかなり防げます。

---

## 仕様上の注意（実装に入る前の“決め”）

ユーザーに違和感が出やすいのがここなので、先に固定します。

### 1) MP3が短い場合

- 書き出し長 > MP3長 のとき：
    
    - **Loop**（つなぎ目はクロスフェード）をデフォルト
        
    - もしくは「MP3の長さに合わせる」を選択肢に
        

### 2) MP3がステレオの場合

- そのまま保持
    
- バイノーラルは左右差が命なので、**ステレオ維持**が前提
    

### 3) 書き出し音量のばらつき対策

- “マスターが割れない”ための **Limiter（内部）** は入れてOK
    
- ユーザーUIには出さず、勝手に守る（ここで沼らせない）
    

---

## 画面の最終形（更新版の下段だけ）

- Upload MP3
    
- MP3再生/停止（プレビュー用）
    
- **MP3 Volume**
    
- **Tone Volume**
    
- （B/Cのみ）**Extra Volume**
    
- （任意）Master / Tone Ducking
    
- Generate Preview (10s)
    
- Export Full
    

---

次は、この仕様で「音のOKカード」も6テーマと同じように短文化します（例：_“音楽が死なない／トーンは感じる／Extraは薄く”_）。  
続けて作ります。

はい。続けて

了解。では「音のOKカード」を、制作中に迷わないレベルまで **短文化**して固定します。  
（10秒プレビューで即チェックできる形）

---

# Audio OKカード（共通：3行で合格）

※プレビュー10秒で判定する

1. **MP3が主役**：音楽の芯が消えてない（トーンが上に乗っても“曲”が聴ける）
    
2. **トーンは存在**：入ってるのは分かるが、耳に刺さらない／覆わない
    
3. **Extraは薄く**：バイノーラル/シューマンは“気配”。うねり・不快が出たら下げる
    

---

# モード別 OKカード（A/B/C）

## A：ソルフェジオのみ（MP3 + Solfeggio）

- **MP3 70 / Tone 25** から始める
    
- 合格：曲が聴ける + トーンが“いる”
    
- NG：トーンが主張して曲が遠い → Tone↓ or MP3↑
    

## B：ソルフェジオ＋バイノーラル（MP3 + Solfeggio + Binaural）

- **Extra 10** から（最初は薄く）
    
- 合格：目的を変えても不快が出ない（違いは“説明できる程度”）
    
- NG：揺れ・気持ち悪さ → Extra↓（まずこれ） / Toneも少し↓
    

## C：ソルフェジオ＋シューマン（MP3 + Solfeggio + Schumann via 7.83Hz binaural）

- **Extra 8〜10** が上限目安（薄め固定で良い）
    
- 合格：長く聴ける“自然な底”が出る（主張しない）
    
- NG：うねりが目立つ → Extra↓（即）
    

---

# 目的5種（バイノーラル）の“キャラ”カード（短文）

※効果保証はしない。UI文言は「モード」扱い

- **Sleep**：丸い／沈む
    
- **Meditation**：内側に静まる
    
- **Relax**：ゆるむ／ほどける
    
- **Focus**：輪郭が立つ
    
- **Peak**：軽く冴える（やりすぎない）
    

---

# ミキサーの「迷わない調整ルール」（最短2手）

プレビューで違和感があったら、触る順番は固定。

1. **MP3 vs Tone のバランス**
    

- 曲が遠い → Tone↓（最優先）
    
- トーンが分からない → Tone↑（上げすぎ注意）
    

2. **Extraの不快対策**（B/Cのみ）
    

- 気持ち悪い／うねる → Extra↓（即）
    
- それでもダメ → Toneも少し↓（次手）
    

> 重要：一度に2本以上いじらない（沼防止）

---

# “事故が減る”デフォルトプリセット（ボタンで用意）

ユーザーが毎回迷うので、プリセットを置くと運用が楽です。

- **Safe（推奨）**：MP3 70 / Tone 20 / Extra 8 / Master 70
    
- **Balanced**：MP3 65 / Tone 25 / Extra 10 / Master 70
    
- **Tone Forward**：MP3 55 / Tone 35 / Extra 12 / Master 70（上級者向け）
    

---

# UIに表示する注意文（短く）

- バイノーラル：**イヤホン推奨**（小さく）
    
- 書き出し：**プレビューOK後にExport**（固定）
    

---

次は、映像のOKカードと音のOKカードを統合して、**「10秒プレビュー判定シート（チェック表）」**を1画面で完結する形に整えます。  
そのまま続けます。

はい。続けて

了解。では **「10秒プレビュー判定シート」**を、UIにそのまま載せられる形で統合します。  
（＝映像OKカード + 音OKカード + 合否ルールが1枚）

---

# 10秒プレビュー判定シート（UI表示用）

## 0) まず表示する“今回の生成条件”（ヘッダー）

- **Solfeggio**：396 / 417 / 528 / 639 / 741 / 852（選択値）
    
- **Audio Mode**：A/B/C（＋Bなら目的、CならSchumann 7.83固定）
    
- **MP3**：ファイル名（未アップなら “No MP3”）
    
- **Preview**：10s / 1080×1920 / 30fps / Loop
    

---

## 1) 映像チェック（共通8項目）※YES/NO

> ここは機械的に判定して沼を止める欄

-  ループが自然（切れ目が分からない）
    
-  点滅が主役になってない
    
-  10秒見て疲れない
    
-  スマホ縮小でも“綺麗”が残る
    
-  圧縮でモアレ/チラつきが出ない
    
-  色が原色っぽくない（品がある）
    
-  急加速・急変がない
    
-  視線が迷子にならない（重心/中心が安定）
    

### 判定（自動表示でも手動でもOK）

- ✅ **6/8以上** → 映像 “合格”
    
- ⚠️ **5/8** → “軽微修正”（後述の「最優先スライダー1本」だけ）
    
- ❌ **4/8以下** → “作り直し”（台本からズレてる）
    

---

## 2) テーマ別OKカード（3行）※YES/NO（自動で差し替え）

選んだソルフェジオに応じて、以下が表示される。

### 例：396Hz（Ground）

-  下に重心：下1/3に安心する重さ
    
-  沈むが増えない：総量一定でループ
    
-  刺激ゼロ：点滅/原色/暴走なし
    

（417/528/639/741/852 も同様に3行表示）

### 判定

- ✅ **2/3以上 YES** → テーマ合格
    
- ⚠️ **1/3** → “要調整”
    
- ❌ **0/3** → “台本から外れてる”
    

---

## 3) 音チェック（共通OKカード3行）※YES/NO

-  **MP3が主役**：曲の芯が消えてない
    
-  **トーンは存在**：入ってるのは分かるが刺さらない
    
-  **Extraは薄く**：不快/うねりが出ない（B/C時）
    

### 判定

- ✅ **2/3以上 YES** → 音合格
    
- ⚠️ **1/3** → バランス調整
    
- ❌ **0/3** → まずプリセット「Safe」に戻す
    

---

## 4) “修正するなら1手だけ” 指示（自動で出す）

判定結果に応じて、UIが次のメッセージを出します。

### A) 映像が⚠️/❌のとき（テーマ別）

> **最優先スライダーを1本だけ**動かして再プレビュー

- 396 → 粒子密度
    
- 417 → 揺らぎ量
    
- 528 → 中心核の強さ
    
- 639 → 境界の柔らかさ
    
- 741 → 霧の量
    
- 852 → 粒子量（余白）
    

### B) 音が⚠️/❌のとき（順番固定）

1. **Tone Volume** を先に調整（曲が遠いなら下げる）
    
2. それでもダメなら **Extra Volume** を下げる（B/Cのみ）  
    ※同時に2本以上いじらない
    

---

## 5) 合格スタンプ（最終）

- 映像：✅（共通6/8以上） AND テーマ：✅（2/3以上）
    
- 音：✅（2/3以上）
    

この3つが揃ったら、画面下に  
✅ **Preview Pass → Export解禁**  
を表示して、**Export Fullボタンを有効化**。

---

# Export時の追加ミニチェック（1行だけ）

Export押下前に1行だけ表示（確認で迷わせない）：

- 「MP3が短い場合はループ（クロスフェード）します」※トグルは出さず自動でもOK
    

---

## 次に固めるべき“出力プリセット”

この判定シートができたので、最後に迷いが出るのは **書き出し秒数** です。  
次は、商品として扱いやすい **Exportプリセット（例：15s/30s/60s/180s）** と、MP3長不足時の挙動（ループ/クロスフェード秒数）を固定します。

このまま続けて、**Exportプリセット案**を出します。

はい。

了解。では **「商品として扱いやすい Export（書き出し）プリセット」**を、迷わない形で固定します。  
（＝ユーザーが選ぶのは“秒数”だけ。MP3が足りなければ自動で綺麗につなぐ）

---

# Exportプリセット（推奨）

まずはこの **4つだけ**で十分です（多すぎると迷う）。

1. **15秒**（SNS最短）
    
2. **30秒**（Reels/Shortsの標準）
    
3. **60秒**（しっかり浸れる）
    
4. **180秒（3分）**（ヒーリング用途の主力）
    

> 追加するなら「600秒（10分）」は“上級者/重い”枠として後からでOK。

---

# Exportの長さの決め方（UIは2択で十分）

Export欄に、秒数プリセットと併せてこの2択だけ置きます。

- **A：選んだ秒数で書き出す（推奨）**
    
- **B：MP3の長さに合わせる（MP3がある時だけ表示）**
    

※Bは「MP3を丸ごと使いたい」人向け。普段はAでOK。

---

# MP3が短い/長い時のルール（自動処理で沼防止）

## 1) Export秒数 > MP3長 の場合

**自動ループ + クロスフェード**で継ぎ目を隠します（デフォルト固定でOK）。

- クロスフェード長：**1.5秒**（固定推奨）
    
- 3分以上は：**2.0秒**でも良い（なめらか重視）
    

> UIで秒数を出すと迷うので、まず固定で。

## 2) Export秒数 < MP3長 の場合

MP3から **切り出し**ます。

- デフォルト：**Auto（中盤30%地点から開始）**
    
- 任意で：**Start位置スライダー（mm:ss）**  
    ※これは「こだわる人用」。最初は隠して“詳細設定”に入れるのが良いです。
    

---

# 出力フォーマット固定（まずはこれでOK）

- **解像度**：1080×1920（固定）
    
- **FPS**：30（固定）
    
- **動画**：MP4（H.264想定）
    
- **音声**：AAC想定 / ステレオ維持（特にバイノーラルのため）
    

> 画質プリセット（High/Standard）を増やすのは後回しでOK。最初は“成立”優先。

---

# 音量の安全策（UIに出さず内部で守る）

MP3の音量はバラつくので、書き出し事故が起きやすいです。  
ユーザーを迷わせないために、内部で次を固定で入れるのが安全です。

- **マスターのピーク保護（Limiter）**：割れ防止（UIなし）
    
- **初期プリセット**（前に決めたやつ）
    
    - Safe：MP3 70 / Tone 20 / Extra 8 / Master 70
        
    - Balanced：MP3 65 / Tone 25 / Extra 10 / Master 70
        

---

# ファイル名ルール（自動で分かる形）

エクスポート後に管理しやすいよう、命名は固定がおすすめ。

例：  
`AuraLoop_528_B_Focus_60s_20251224_2030.mp4`  
（周波数 / モード / 目的 / 秒数 / 日時）

---

# 書き出し時の最終ミニ確認（1行だけ）

Exportボタン押下時に、これだけ表示（OK/Cancel）。

- 「MP3が短い場合はループ＋1.5秒クロスフェードでつなぎます」
    

---

## 次に固めると“完成イメージ”がさらにズレなくなる部分

最後に、映像の **Theme Strength** を「どこまで触れるか」を決めると安定します。

おすすめはこの2段階：

- **Basic**：Theme Strength だけ（1本）
    
- **Advanced（隠す）**：奥行き / コントラスト / 速度（でも最大3本まで）
    

この方針で、次に「Basicの範囲（どこまで動くと別物になるか）」を固定します。続けます。

はい。

了解。では「**Theme Strength をどこまで触らせるか**」を固定して、**“別物になってしまう”事故を防ぐガードレール**を作ります。  
結論から言うと、最初は **Basic（1本）**で十分です。Advancedは“隠しメニュー”にして、触っても壊れない範囲だけ解放します。

---

# 1) UI方針：Basic 1本 + Advancedは隠す

## Basic（常に表示）

- **Theme Strength（0–100）** ←映像はこれだけ触れる
    

## Advanced（折りたたみ・上級者向け）

最大でも **3本まで**（増やすと沼）

- **Depth（奥行き）**
    
- **Motion（速度）**
    
- **Contrast（コントラスト）**
    

> これ以外（色相・対称性・粒サイズ等）は最初は封印でOK。  
> 「テーマが壊れる」「安っぽくなる」原因になりやすいからです。

---

# 2) Theme Strength の「安全ゾーン」を固定

ユーザーがやりすぎて別物にならないよう、**0–100のうち“効く範囲”を狭くする**のがコツです。

- 実際に効かせるのは内部的に **35〜65**（＝安全ゾーン）
    
- UI上は0〜100だけど、内部マッピングはこうする：
    
    - 0〜25：ほぼ変わらない（“やりすぎ防止”の遊び）
        
    - 25〜75：**ここが実質の調整域（本当に効く）**
        
    - 75〜100：少ししか増えない（“盛りすぎ防止”の天井）
        

これで「100にしたらチープになった」が起きにくくなります。

---

# 3) Theme Strength が動かす中身（テーマ別：固定）

Basicの1本は、前に決めた「最優先スライダー」を動かしますが、**“触っても壊れない範囲”**を予め決めておきます。

- **396**：粒子密度（下1/3の重さ）
    
    - 最低：スカスカになっても「暗い霧」は残す
        
    - 最大：過密でザラつく直前で止める
        
- **417**：揺らぎ量（ほどけ具合）
    
    - 最低：流れは保つ（静止にしない）
        
    - 最大：散らずに“ほどける”まで（破裂はさせない）
        
- **528**：中心核の強さ（引力＋発光）
    
    - 最低：核が消えない（テーマ消失防止）
        
    - 最大：爆発演出に見える手前で止める
        
- **639**：境界の柔らかさ（ブレンド幅）
    
    - 最低：2つが“別々”でも柔らかい
        
    - 最大：全部が一色のモヤになる手前で止める
        
- **741**：霧の量（ヘイズ）
    
    - 最低：霧がゼロになってテックっぽくならない
        
    - 最大：霧で何も見えない手前で止める
        
- **852**：粒子量（余白）
    
    - 最低：余白が死なない（星だらけ禁止）
        
    - 最大：寂しすぎて無になる手前で止める
        

---

# 4) Advanced（隠し）の3本：何をどこまで許すか

Advancedを触っても「テーマが壊れない」ように、**可動域を狭く**します。

## Depth（奥行き）

- 影響：遠景の層の厚み・パララックス感
    
- 安全範囲：**Low〜Mid**（深くしすぎると“宇宙SF”になりやすい）
    

## Motion（速度）

- 影響：全体の流れの速さ
    
- 安全範囲：**0.8x〜1.2x**相当  
    ※早くしすぎると刺激になる／遅すぎると退屈
    

## Contrast（コントラスト）

- 影響：上品さ vs チープの分岐点
    
- 安全範囲：**-10%〜+10%**相当  
    ※上げすぎると原色感・ギラつきが出る
    

> Advancedを開いた瞬間に注意文を1行だけ：  
> 「テーマが崩れたら Advanced を全部戻して、Theme Strength だけで調整してください」

---

# 5) リセット設計（沼対策の最後の砦）

- **Reset Visual（映像だけ初期化）**
    
- **Reset Audio（音だけ初期化）**
    
- **Reset All（全部初期化）**
    
- さらに便利なのが **A/B比較**：
    
    - “直前の設定”を1つだけ保存して、ワンクリックで戻せる（Undo 1回）
        

---

# 6) 10秒プレビューの「おすすめ調整順」もUIに出す

プレビューで違和感があったら、この順でしか触らない：

1. **Theme Strength**（映像）
    
2. **Tone Volume**（曲が遠いなら下げる）
    
3. **Extra Volume**（気持ち悪いなら下げる）
    
4. （どうしても）Advancedの Depth/Motion/Contrast のどれか1本だけ
    

---

次は、ここまで固めた仕様を **「MVP仕様書 1枚」**にまとめます。  
（画面構成・入力・出力・プレビューゲート・パラメータ・デフォルト・ファイル命名まで全部入り）  
そのまま続けます。

はい

了解。ではここまでの決定事項を **「MVP仕様書 1枚」**としてまとめます（このまま開発チケットに切れます）。

---

# AuraLoop Studio（Web版B案）MVP仕様書 v1

## 目的

- **映像ゼロ生成（プリセット）**＋**ユーザーMP3にソルフェジオ等をミックス**して、縦動画MP4を書き出す。
    
- 失敗を防ぐため **10秒プレビューで合否→OKならExport** のゲート方式。
    

---

## 入力

### 1) ソルフェジオ（必須）

- 6択：396 / 417 / 528 / 639 / 741 / 852
    
- **映像テーマは常にソルフェジオが優先**（音モードで映像テーマは変えない）
    

### 2) 音モード（必須）

- A：ソルフェジオのみ
    
- B：ソルフェジオ＋バイノーラル（目的5択）
    
- C：ソルフェジオ＋シューマン（7.83Hz差をバイノーラルで生成）
    

### 3) MP3アップロード（推奨・任意）

- ユーザーがヒーリング音楽等のMP3をアップロード
    
- MP3がない場合でも生成可（トーンのみで成立）
    

---

## 出力

- **MP4（縦 9:16）**
    
- 解像度：**1080×1920 固定**
    
- FPS：**30 固定**
    
- 音声：**ステレオ維持**（バイノーラル対応のため）
    

---

## 画面（1画面完結）

### A) プレビュー領域

- 9:16プレビュー（常にループON）
    
- ステータス：Preview 10s / 1080×1920 / 30fps
    

### B) コントロール

#### 1) ソルフェジオ選択（6ボタン）

#### 2) 音モード選択（A/B/C）

- B選択時のみ：目的5択（Sleep/Meditation/Relax/Focus/Peak）
    

#### 3) MP3操作

- Upload MP3
    
- 再生/停止（プレビュー確認用）
    
- 表示：ファイル名 / 長さ（簡易でOK）
    

#### 4) 映像スライダー（Basic）

- **Theme Strength（0–100）**：常時表示
    
    - 内部は“安全ゾーン”中心（盛りすぎ防止のマッピング）
        

#### 5) 音ミキサー（必須）

- **MP3 Volume（0–100）**
    
- **Tone Volume（0–100）**（ソルフェジオ）
    
- **Extra Volume（0–100）**（モードB/Cのみ：バイノーラルorシューマン）
    
- （任意）Master（0–100）
    
- （任意）Tone Ducking（0–100）※MP3主役を守る
    

#### 6) Advanced（折りたたみ・上級者）

最大3本のみ、可動域は狭く固定：

- Depth（奥行き）
    
- Motion（速度）
    
- Contrast（コントラスト）
    

#### 7) アクション（2つだけ）

- **Generate Preview (10s)**
    
- **Export Full**（プレビュー合格後のみ有効）
    

#### 8) リセット

- Reset Visual / Reset Audio / Reset All
    
- Undo 1回（直前状態に戻す）
    

---

## プレビュー仕様（10秒固定）

- 10秒は固定（長さ選択なし）
    
- MP3プレビュー区間：
    
    - **Auto（推奨）**：中盤30%地点から10秒
        
    - （任意）Pick：開始位置スライダー（詳細設定に隠す）
        

---

## Exportプリセット（秒数だけ選ぶ）

- 15s / 30s / 60s / 180s（3分）
    
- 追加するなら後で10分枠
    

### MP3長不足時

- **自動ループ + クロスフェード**（固定）
    
    - クロスフェード：1.5秒（3分以上は2.0秒でも可）
        

### MP3が長い時

- 指定秒数ぶん切り出し（Auto or Pick）
    

---

## 判定シート（UIに表示）

### 映像：共通8項目（6/8以上で合格）

- ループ自然 / 点滅主役なし / 疲れない / スマホで成立 / モアレなし / 原色なし / 急加速なし / 視線安定
    

### テーマ別OKカード（3行、2/3以上で合格）

- 396：下に重心 / 沈むが増えない / 刺激ゼロ
    
- 417：ほどける / 透明が一度増す / 散らさない
    
- 528：集まって揃う / 核は澄んだ光 / 整う→少し戻す
    
- 639：二つが混ざる / 柔らかい / 甘さにしない
    
- 741：霧が抜ける / 少しだけ輪郭 / 冷たすぎない
    
- 852：余白が美しい / 上昇一貫 / 星は少量高品位
    

### 音：OKカード（2/3以上で合格）

- MP3が主役 / トーンは存在 / Extraは薄く
    

---

## 初期デフォルト（事故が少ない）

- Theme Strength：50
    
- 音プリセットボタン：
    
    - Safe：MP3 70 / Tone 20 / Extra 8 / Master 70
        
    - Balanced：MP3 65 / Tone 25 / Extra 10 / Master 70
        
    - Tone Forward：MP3 55 / Tone 35 / Extra 12 / Master 70（上級）
        

---

## ファイル名（自動）

`AuraLoop_<Hz>_<Mode>_<GoalOrSchumann>_<Duration>s_<YYYYMMDD_HHMM>.mp4`  
例：`AuraLoop_528_B_Focus_60s_20251224_2030.mp4`

---

## 次の作業（開発前の最後の確認）

- 「映像プリセットを何方式で作るか」（パーティクル/万華鏡/シェーダーなど）は後段でOK
    
- ただし、MVPでまず作る映像は **4本から**（396/528/852/741）→合格後に残り2本（417/639）
    

---

次はこの仕様書を元に、**映像プリセットの最小セット（4本）の具体“実装に落ちる構成”**にします。  
（＝どんな方式でも再現できるように、プリセットを「粒子/流れ/膜/奥行き」の組み合わせに分解して定義します）

はい

了解。では **MVPで先に作る4本（396/528/741/852）**を、実装方式に依存しない形で「**再現可能な部品（レイヤー）**」に分解して定義します。  
Three.jsでもCanvas2Dでもシェーダでも、ここに沿えば同じ“完成物”に寄せられます。

---

# 映像プリセット定義（実装非依存・共通フレーム）

各プリセットは、下の **4レイヤー**で構成します。

1. **Background（ベース）**：暗部の色・グラデ・ビネット
    
2. **Haze / Film（霧・膜）**：薄い霞、ガラス膜、オーロラ膜（ゆっくり揺れる）
    
3. **Particles（粒子）**：点・微粒子（密度/サイズ/発光/深度）
    
4. **Guidance（流れ/引力）**：粒子の“動きの規則”（沈降/引き寄せ/上昇/晴れ）
    

共通の出力条件：**9:16 / 1080×1920 / 30fps / 10秒ループ**

---

# ループを必ず成立させる「ループ設計ルール」

**10秒で完全に同じ状態に戻る**のが最優先です。

- 時間 `t` は必ず **周期関数**で使う：  
    `phase = 2π * t / 10` を基本に、`sin(phase) / cos(phase)`で揺らぎを作る
    
- 粒子の位置は「流しっぱなし」禁止。**循環**させる
    
    - 上に行った粒は遠景で回り込み、下に薄く戻す
        
    - もしくは `pos = base + A*sin(phase+seed)` のように **往復**させる
        
- “増える/減る”演出はしない（総量一定）
    

---

# パラメータ（UIのスライダーに結びつける）

## Basic：Theme Strength（0–100）

内部では安全ゾーンにマッピングして、下記の **主パラメータ**だけ動かします（壊れにくい）。

- 396：`particle_density_bottom`
    
- 528：`core_strength`
    
- 741：`haze_amount`
    
- 852：`particle_count`（＝余白）
    

## Advanced（隠し）

- Depth：`depth_layers_intensity`（遠景層の厚み）
    
- Motion：`global_speed`（0.8〜1.2相当）
    
- Contrast：`contrast_bias`（±10%相当）
    

---

# 4プリセットの実装定義（MVP先行）

## 396Hz｜Ground（沈降・定着）

### 目的（見え方）

下1/3に“重さ”が溜まる。沈むが、**溜まり続けない**。

### パレット（目安）

- BG：#120002〜#030001（深赤〜黒）
    
- Glow：暗い朱〜鈍い金（白飛び禁止）
    

### レイヤー定義

1. Background：暗い縦グラデ＋弱いビネット（下が少し明るい）
    
2. Haze：薄い霧（揺れは小さく、1周期で戻る）
    
3. Particles：微粒子（深度あり、サイズは中〜小、強発光なし）
    
4. Guidance：**沈降 + 下部で“緩衝”して戻る循環**
    
    - 下に落ちるが、下端で吸収せず、遠景経路で上に薄く戻す
        

### Theme Strengthで動くもの（最優先）

- `particle_density_bottom`：下1/3の密度だけ増減（全体は増やさない）
    

### NG防止のハード制限

- 点滅禁止（明滅は霧の濃淡程度）
    
- 速度上限を低く固定（落ち着き優先）
    

---

## 528Hz｜Repair（中心核・整列）

### 目的（見え方）

散った粒子が中心に“寄って”、動きが**揃う**。核は澄んだ光。

### パレット（目安）

- BG：深緑〜エメラルド
    
- Glow：黄緑〜金（透明、白飛び禁止）
    

### レイヤー定義

1. Background：深緑ベース＋弱い中心明るさ（中心核の下地）
    
2. Haze：薄い“ガラス膜”（中心付近がほんの少し厚い）
    
3. Particles：中密度、深度あり（近景は少し大きい）
    
4. Guidance：**中心引力 + 整列（方向を揃える）**
    
    - 0〜5秒で「寄る」
        
    - 5〜7秒で「揃う」
        
    - 9〜10秒で少し散らして初期に戻す（ループ接続）
        

### Theme Strengthで動くもの（最優先）

- `core_strength`：引力の強さ＋核の発光を一体で（爆発手前で止める）
    

### NG防止のハード制限

- コントラスト上げすぎ禁止（SF化）
    
- スパークル（キラ点滅）禁止
    

---

## 741Hz｜Clear（霧が抜ける・澄む）

### 目的（見え方）

“曇り”が晴れていく。輪郭が少し立つが、テックデモにはしない。

### パレット（目安）

- BG：青〜シアン（冷たくしすぎない）
    
- Glow：透明白（刺さらない）
    

### レイヤー定義

1. Background：青系グラデ（明るすぎない）
    
2. Haze：**霧が主役**（2.5〜6秒で薄くなる）
    
3. Particles：少〜中（細かすぎない、モアレ回避）
    
4. Guidance：粒子は“静かに整う”程度（派手な流れは不要）
    

### Theme Strengthで動くもの（最優先）

- `haze_amount`：霧の厚み（0にしない＝テック化防止）
    

### NG防止のハード制限

- シャープ/エッジ強調の上限を低く
    
- 青の高コントラスト禁止（刺さる）
    

---

## 852Hz｜Intuition（上昇・余白・星屑）

### 目的（見え方）

余白が美しい。星屑は少量で高品位。上昇の一貫性と奥行きが主役。

### パレット（目安）

- BG：紫〜紺
    
- Glow：白〜淡紫（上品）
    

### レイヤー定義

1. Background：暗い紫〜紺、遠景が深く見えるグラデ
    
2. Haze：遠景にだけ薄い“オーロラ膜”（1周期で呼吸1回）
    
3. Particles：低密度（余白確保）、深度強め（奥行き最大）
    
4. Guidance：**上昇 + 循環**
    
    - 上に流すだけだとループが割れるので、遠景で回り込ませて下に薄く戻す
        

### Theme Strengthで動くもの（最優先）

- `particle_count`：粒子量（増やしすぎ禁止、余白が死んだら負け）
    

### NG防止のハード制限

- 点滅禁止
    
- 粒子最大数に天井（“クリスマス化”防止）
    

---

# 4本を先に作る理由（実務）

- 396：重さ・沈降（事故が出やすい）
    
- 528：核・整列（演出過多になりやすい）
    
- 741：霧（差が分かりやすい）
    
- 852：余白（品が出るかの最終関門）
    

この4本が合格したら、417/639は同じ枠組みで“横展開”できます。

---

次はこの定義を、開発でそのまま使える **「プリセットJSON設計（パラメータ名・範囲・初期値）」**に落とします（コードはまだ書かず、仕様としてのJSON）。

はい

了解。ではコード実装に入る前段として、**プリセットJSON設計（パラメータ名・範囲・初期値）**を定義します。  
Three.jsでもCanvasでもShaderでも、ここを“契約”にすると開発がブレません。

---

# Preset JSON Spec v1（実装非依存）

## 1) 全体構造

- `preset_id`：一意（例 `P396_GROUND_v1`）
    
- `duration_sec`：10固定（プレビュー）
    
- `loop`：true固定
    
- `palette`：BG/Glow等の色
    
- `layers`：background/haze/particles/guidance
    
- `ui_mapping`：Theme Strength と Advanced の紐づけ
    
- `limits`：ハード制限（点滅禁止、粒子数天井など）
    

---

## 2) 共通パラメータ（型と意味）

### background

- `bg_gradient_top` (color)
    
- `bg_gradient_bottom` (color)
    
- `vignette_strength` (0..1)
    

### haze

- `haze_amount` (0..1) …霧の厚み
    
- `haze_motion` (0..1) …霧の揺れ
    
- `haze_breath_cycles` (int) …10秒で何回“呼吸”するか（基本1）
    
- `haze_depth_bias` (-1..1) …手前/奥どちらに置くか
    

### particles

- `particle_count` (int)
    
- `particle_size_min` (px)
    
- `particle_size_max` (px)
    
- `particle_opacity` (0..1)
    
- `particle_glow` (0..1) …発光の強さ（点滅ではなく常光）
    
- `particle_depth_layers` (int) …奥行き層
    
- `particle_depth_spread` (0..1) …層の広がり
    
- `particle_noise_amount` (0..1) …ランダム揺らぎ量（上げすぎ禁止）
    

### guidance（動きの規則）

- `global_speed` (0.8..1.2) …Advancedでのみ
    
- `flow_type` (enum) …`sink`, `core_pull`, `clear_reveal`, `rise_cycle`
    
- `flow_strength` (0..1)
    
- `flow_symmetry` (0..1) …万華鏡寄りにしないため上限低め
    
- `loop_method` (enum) …`sinusoidal`, `cycle_path`
    
- `loop_phase_offset` (0..1)
    

### safety / limits

- `max_flicker` (0..1) …基本0（点滅禁止）
    
- `max_contrast_boost` (0..0.1) …±10%相当
    
- `max_particle_count` (int)
    
- `max_speed` (float)
    

---

# 3) MVP先行4本：Preset JSON（例）

以下は“実際に保存するJSONの形”です（コメントなし前提）。

---

## P396_GROUND_v1

`{   "preset_id": "P396_GROUND_v1",   "hz": 396,   "name": "Ground",   "duration_sec": 10,   "loop": true,   "palette": {     "bg_gradient_top": "#120002",     "bg_gradient_bottom": "#030001",     "glow_primary": "#6b1a10",     "glow_secondary": "#4a3a10"   },   "layers": {     "background": {       "vignette_strength": 0.45     },     "haze": {       "haze_amount": 0.28,       "haze_motion": 0.18,       "haze_breath_cycles": 1,       "haze_depth_bias": 0.2     },     "particles": {       "particle_count": 900,       "particle_size_min": 1.0,       "particle_size_max": 2.6,       "particle_opacity": 0.35,       "particle_glow": 0.15,       "particle_depth_layers": 4,       "particle_depth_spread": 0.55,       "particle_noise_amount": 0.12     },     "guidance": {       "flow_type": "sink",       "flow_strength": 0.42,       "flow_symmetry": 0.15,       "loop_method": "cycle_path",       "loop_phase_offset": 0.0     }   },   "ui_mapping": {     "theme_strength_controls": "particle_density_bottom",     "advanced_controls": ["depth", "motion", "contrast"]   },   "limits": {     "max_flicker": 0.0,     "max_contrast_boost": 0.08,     "max_particle_count": 1400,     "max_speed": 1.05   } }`

---

## P528_REPAIR_v1

`{   "preset_id": "P528_REPAIR_v1",   "hz": 528,   "name": "Repair",   "duration_sec": 10,   "loop": true,   "palette": {     "bg_gradient_top": "#05210f",     "bg_gradient_bottom": "#02140a",     "glow_primary": "#a8d24a",     "glow_secondary": "#c8a84a"   },   "layers": {     "background": {       "vignette_strength": 0.35     },     "haze": {       "haze_amount": 0.22,       "haze_motion": 0.20,       "haze_breath_cycles": 1,       "haze_depth_bias": 0.0     },     "particles": {       "particle_count": 750,       "particle_size_min": 1.2,       "particle_size_max": 3.0,       "particle_opacity": 0.33,       "particle_glow": 0.22,       "particle_depth_layers": 5,       "particle_depth_spread": 0.65,       "particle_noise_amount": 0.10     },     "guidance": {       "flow_type": "core_pull",       "flow_strength": 0.48,       "flow_symmetry": 0.28,       "loop_method": "sinusoidal",       "loop_phase_offset": 0.0     }   },   "ui_mapping": {     "theme_strength_controls": "core_strength",     "advanced_controls": ["depth", "motion", "contrast"]   },   "limits": {     "max_flicker": 0.0,     "max_contrast_boost": 0.08,     "max_particle_count": 1200,     "max_speed": 1.10   } }`

---

## P741_CLEAR_v1

`{   "preset_id": "P741_CLEAR_v1",   "hz": 741,   "name": "Clear",   "duration_sec": 10,   "loop": true,   "palette": {     "bg_gradient_top": "#05152a",     "bg_gradient_bottom": "#02101d",     "glow_primary": "#d7f3ff",     "glow_secondary": "#7fd3ff"   },   "layers": {     "background": {       "vignette_strength": 0.30     },     "haze": {       "haze_amount": 0.40,       "haze_motion": 0.16,       "haze_breath_cycles": 1,       "haze_depth_bias": 0.1     },     "particles": {       "particle_count": 520,       "particle_size_min": 1.0,       "particle_size_max": 2.4,       "particle_opacity": 0.28,       "particle_glow": 0.18,       "particle_depth_layers": 4,       "particle_depth_spread": 0.50,       "particle_noise_amount": 0.08     },     "guidance": {       "flow_type": "clear_reveal",       "flow_strength": 0.40,       "flow_symmetry": 0.18,       "loop_method": "sinusoidal",       "loop_phase_offset": 0.0     }   },   "ui_mapping": {     "theme_strength_controls": "haze_amount",     "advanced_controls": ["depth", "motion", "contrast"]   },   "limits": {     "max_flicker": 0.0,     "max_contrast_boost": 0.08,     "max_particle_count": 900,     "max_speed": 1.10   } }`

---

## P852_INTUITION_v1

`{   "preset_id": "P852_INTUITION_v1",   "hz": 852,   "name": "Intuition",   "duration_sec": 10,   "loop": true,   "palette": {     "bg_gradient_top": "#140a2a",     "bg_gradient_bottom": "#070414",     "glow_primary": "#f3e9ff",     "glow_secondary": "#b89cff"   },   "layers": {     "background": {       "vignette_strength": 0.42     },     "haze": {       "haze_amount": 0.18,       "haze_motion": 0.22,       "haze_breath_cycles": 1,       "haze_depth_bias": -0.3     },     "particles": {       "particle_count": 320,       "particle_size_min": 1.0,       "particle_size_max": 2.8,       "particle_opacity": 0.26,       "particle_glow": 0.28,       "particle_depth_layers": 6,       "particle_depth_spread": 0.80,       "particle_noise_amount": 0.10     },     "guidance": {       "flow_type": "rise_cycle",       "flow_strength": 0.36,       "flow_symmetry": 0.10,       "loop_method": "cycle_path",       "loop_phase_offset": 0.0     }   },   "ui_mapping": {     "theme_strength_controls": "particle_count",     "advanced_controls": ["depth", "motion", "contrast"]   },   "limits": {     "max_flicker": 0.0,     "max_contrast_boost": 0.08,     "max_particle_count": 520,     "max_speed": 1.08   } }`

---

# 4) Theme Strength の内部マッピング（仕様）

UIの `Theme Strength (0..100)` を内部パラメータに変換するルールを固定します。

- `s = ThemeStrength / 100`
    
- “効く範囲”は 0.25〜0.75 に寄せる（盛りすぎ防止）
    
- 各プリセットの `ui_mapping.theme_strength_controls` に応じて、次のレンジで変換：
    

例（目安）：

- 396 `particle_density_bottom`: 0.75x 〜 1.25x
    
- 528 `core_strength`: 0.80x 〜 1.20x
    
- 741 `haze_amount`: 0.80x 〜 1.20x（ただし0にしない）
    
- 852 `particle_count`: 0.70x 〜 1.15x（天井あり）
    

※ここは“係数だけ”で調整し、挙動を複雑にしない（ブレ防止）。

---

次は、音側も同じように **Audio JSON Spec（MP3 + Tone + Extra のミキサー、目的5種、Schumann固定）** を定義して、映像プリセットと結合できる形にします。

はい

了解。では **Audio JSON Spec v1** を「実装非依存」で定義して、さっきの **Video Preset JSON** と結合できる形まで落とします。  
（Three.jsでもffmpeg.wasmでも、Audio側の契約として固定できる）

---

# Audio JSON Spec v1（実装非依存）

## 0) 基本方針（仕様として固定）

- 音源は **最大3レイヤー**
    
    1. `mp3_bed`（ユーザーMP3）
        
    2. `tone_solfeggio`（ソルフェジオ）
        
    3. `extra`（バイノーラル or シューマン7.83差）
        
- ミキサーは **MP3 / Tone / Extra / Master** の4ゲイン（UIに対応）
    
- バイノーラルは **ステレオ前提**（イヤホン推奨の注意文はUIで表示）
    
- MP3が短い場合は **自動ループ＋クロスフェード**（UIに露出しない）
    

---

## 1) JSON構造（スキーマ）

`{   "audio_spec_version": "1.0",   "mode": "A|B|C",   "mp3_bed": { ... },   "tone_solfeggio": { ... },   "extra": { ... },   "mixer": { ... },   "safety": { ... },   "ui_notes": { ... } }`

---

## 2) 各ブロック定義

### mp3_bed（ユーザーMP3）

- `enabled` (bool)
    
- `source` (string) : ファイル参照ID/パス/URL等（実装側で解釈）
    
- `preview_segment` : 10秒プレビューでどこを使うか
    
    - `policy`: `"auto_mid"` or `"pick"`
        
    - `pick_start_sec`: number（pickのときのみ）
        
    - `auto_mid_ratio`: number（例 0.30）
        
- `export_segment`
    
    - `policy`: `"fit_export"`（書き出し秒数に合わせて切り出し/ループ） or `"match_mp3"`（MP3長に合わせる）
        
- `looping`
    
    - `enabled`: true/false（基本trueでOK）
        
    - `crossfade_sec`: 1.5（固定推奨）
        
- `stereo_mode`: `"preserve"` 固定推奨
    

### tone_solfeggio（ソルフェジオ）

- `enabled` (bool)
    
- `hz` (number) : 396/417/528/639/741/852
    
- `waveform`: `"sine"`（MVPは固定推奨）
    
- `harmonics`（任意、MVPはオフ推奨）
    
    - `enabled`: false
        
    - `amount`: 0..1
        
- `stereo`: `"dual_mono"`（左右同一）推奨
    
- `phase_lock`: true（ループ境界で位相が飛びにくい）
    

### extra（モードB/Cのみ）

- mode B（バイノーラル）
    
    - `type`: `"binaural"`
        
    - `carrier_hz`: 200（例：200Hz）
        
    - `beat_hz`: 目的で決まる差分
        
    - `goal`: `"sleep|meditation|relax|focus|peak"`
        
- mode C（シューマン）
    
    - `type`: `"schumann_binaural"`
        
    - `carrier_hz`: 200
        
    - `beat_hz`: 7.83（固定）
        
- `stereo`: `"binaural_lr"`（L=carrier、R=carrier+beat）
    

### mixer（ゲインとダッキング）

- `gain_mp3` (0..100)
    
- `gain_tone` (0..100)
    
- `gain_extra` (0..100) ※B/Cのみ
    
- `gain_master` (0..100)
    
- `ducking`（任意だが事故が減る）
    
    - `enabled` (bool)
        
    - `target`: `"tone"`（MP3が鳴ってる時だけtoneを少し下げる）
        
    - `amount` (0..100)
        
    - `attack_ms`, `release_ms`（固定でもOK）
        

> 0..100 はUI値。実装は dBカーブ推奨（例：0→-∞、50→-18dB、100→0dB）ですが、ここでは“値の契約”として固定。

### safety（内部保護：UIに出さない）

- `limiter_enabled`: true
    
- `limiter_ceiling_db`: -1.0（固定）
    
- `max_extra_gain_cap`: 20（Extraの上限キャップ：事故防止）
    
- `no_flicker_audio`: true（意味的に：急な爆音を防ぐ）
    

### ui_notes（表示用）

- `headphone_recommended`: true/false（B/Cはtrue）
    
- `disclaimer_short`: string（例：「イヤホン推奨。体調に合わせて音量を調整してください。」）
    

---

# 3) 目的5種（バイノーラル）の差分（beat_hz）を固定

※“効果保証”ではなく、あくまでモード名の設計です。

`{   "binaural_goals": {     "sleep": 3.5,     "meditation": 6.0,     "relax": 10.0,     "focus": 16.0,     "peak": 40.0   } }`

---

# 4) Audio設定の実例（モード別 JSON）

## A：Solfeggio only（MP3 + Tone）

`{   "audio_spec_version": "1.0",   "mode": "A",   "mp3_bed": {     "enabled": true,     "source": "user_mp3_ref",     "preview_segment": { "policy": "auto_mid", "auto_mid_ratio": 0.3 },     "export_segment": { "policy": "fit_export" },     "looping": { "enabled": true, "crossfade_sec": 1.5 },     "stereo_mode": "preserve"   },   "tone_solfeggio": {     "enabled": true,     "hz": 528,     "waveform": "sine",     "harmonics": { "enabled": false, "amount": 0.0 },     "stereo": "dual_mono",     "phase_lock": true   },   "extra": { "enabled": false },   "mixer": {     "gain_mp3": 70,     "gain_tone": 20,     "gain_master": 70,     "ducking": { "enabled": true, "target": "tone", "amount": 20, "attack_ms": 40, "release_ms": 220 }   },   "safety": {     "limiter_enabled": true,     "limiter_ceiling_db": -1.0,     "max_extra_gain_cap": 20,     "no_flicker_audio": true   },   "ui_notes": {     "headphone_recommended": false,     "disclaimer_short": "音量は無理のない範囲で調整してください。"   } }`

## B：Solfeggio + Binaural（MP3 + Tone + Extra）

`{   "audio_spec_version": "1.0",   "mode": "B",   "mp3_bed": {     "enabled": true,     "source": "user_mp3_ref",     "preview_segment": { "policy": "auto_mid", "auto_mid_ratio": 0.3 },     "export_segment": { "policy": "fit_export" },     "looping": { "enabled": true, "crossfade_sec": 1.5 },     "stereo_mode": "preserve"   },   "tone_solfeggio": {     "enabled": true,     "hz": 396,     "waveform": "sine",     "harmonics": { "enabled": false, "amount": 0.0 },     "stereo": "dual_mono",     "phase_lock": true   },   "extra": {     "enabled": true,     "type": "binaural",     "goal": "focus",     "carrier_hz": 200.0,     "beat_hz": 16.0,     "stereo": "binaural_lr"   },   "mixer": {     "gain_mp3": 70,     "gain_tone": 20,     "gain_extra": 8,     "gain_master": 70,     "ducking": { "enabled": true, "target": "tone", "amount": 20, "attack_ms": 40, "release_ms": 220 }   },   "safety": {     "limiter_enabled": true,     "limiter_ceiling_db": -1.0,     "max_extra_gain_cap": 20,     "no_flicker_audio": true   },   "ui_notes": {     "headphone_recommended": true,     "disclaimer_short": "バイノーラルはイヤホン推奨。音量は無理のない範囲で。"   } }`

## C：Solfeggio + Schumann（MP3 + Tone + Extra固定7.83）

`{   "audio_spec_version": "1.0",   "mode": "C",   "mp3_bed": {     "enabled": true,     "source": "user_mp3_ref",     "preview_segment": { "policy": "auto_mid", "auto_mid_ratio": 0.3 },     "export_segment": { "policy": "fit_export" },     "looping": { "enabled": true, "crossfade_sec": 1.5 },     "stereo_mode": "preserve"   },   "tone_solfeggio": {     "enabled": true,     "hz": 852,     "waveform": "sine",     "harmonics": { "enabled": false, "amount": 0.0 },     "stereo": "dual_mono",     "phase_lock": true   },   "extra": {     "enabled": true,     "type": "schumann_binaural",     "carrier_hz": 200.0,     "beat_hz": 7.83,     "stereo": "binaural_lr"   },   "mixer": {     "gain_mp3": 70,     "gain_tone": 20,     "gain_extra": 8,     "gain_master": 70,     "ducking": { "enabled": true, "target": "tone", "amount": 20, "attack_ms": 40, "release_ms": 220 }   },   "safety": {     "limiter_enabled": true,     "limiter_ceiling_db": -1.0,     "max_extra_gain_cap": 20,     "no_flicker_audio": true   },   "ui_notes": {     "headphone_recommended": true,     "disclaimer_short": "イヤホン推奨。違和感があればExtraを下げてください。"   } }`

---

# 5) Video Preset と Audio Config を結合する「Project JSON」ひな形

最後に、これで **1回の生成ジョブ**を完全に表現できます。

`{   "project_version": "1.0",   "video_preset_id": "P528_REPAIR_v1",   "audio": { "...Audio JSON Spec v1..." : true },   "export": {     "resolution": [1080, 1920],     "fps": 30,     "duration_sec": 60,     "format": "mp4_h264_aac",     "filename_template": "AuraLoop_{hz}_{mode}_{goal}_{dur}s_{datetime}.mp4"   },   "preview": {     "duration_sec": 10,     "resolution": [1080, 1920],     "fps": 30   } }`

---

次は、UI操作とJSONを直結させるために  
**「UIコントロール → JSONフィールド対応表（マッピング表）」**を作ります。  
（例：Tone Volumeスライダーが `mixer.gain_tone`、目的選択が `extra.goal` など）

はい

了解。では **UIコントロール → Project JSON フィールド対応表** を作ります。  
これがあると、UI実装と保存/読み込み/生成ジョブが1本で繋がります。

---

# UI → JSON マッピング表（Project v1.0）

## 0) ルール

- UIで変更された値は **必ずProject JSON** に反映
    
- `video_preset_id` は選択で決まる（周波数ごとに固定プリセットIDを紐づけ）
    
- `audio.mode` により `audio.extra` の表示/非表示が切り替わる
    

---

## 1) ソルフェジオ（映像テーマの根）

|UI|型|JSON|備考|
|---|---|---|---|
|Solfeggio（396/417/528/639/741/852）|enum|`audio.tone_solfeggio.hz`|音の主役周波数|
|同上（映像テーマ）|enum|`video_preset_id`|例：528→`P528_REPAIR_v1`|

> **重要**：ソルフェジオ選択は「音のhz」と「映像プリセット」を同時に変える。

---

## 2) 音モード（A/B/C）

|UI|型|JSON|備考|
|---|---|---|---|
|Audio Mode（A/B/C）|enum|`audio.mode`||
|（Aのとき）Extra欄|-|`audio.extra.enabled=false`|UI非表示|
|（B/Cのとき）Extra欄|-|`audio.extra.enabled=true`|UI表示|

---

## 3) バイノーラル目的（Bのみ）

|UI|型|JSON|備考|
|---|---|---|---|
|Goal（Sleep/Meditation/Relax/Focus/Peak）|enum|`audio.extra.goal`|Bのみ|
|carrier|number|`audio.extra.carrier_hz`|MVPは固定200でもOK|
|beat_hz|number|`audio.extra.beat_hz`|goalから自動セット|
|type|enum|`audio.extra.type="binaural"`|固定|
|stereo|enum|`audio.extra.stereo="binaural_lr"`|固定|

### goal → beat_hz 自動対応（固定表）

- sleep: 3.5
    
- meditation: 6.0
    
- relax: 10.0
    
- focus: 16.0
    
- peak: 40.0
    

---

## 4) シューマン（Cのみ）

|UI|型|JSON|備考|
|---|---|---|---|
|Schumann（ON）|-|`audio.extra.type="schumann_binaural"`|C固定|
|beat|number|`audio.extra.beat_hz=7.83`|固定|
|carrier|number|`audio.extra.carrier_hz=200`|固定推奨|
|stereo|enum|`audio.extra.stereo="binaural_lr"`|固定|

---

## 5) MP3アップロードとプレビュー区間

|UI|型|JSON|備考|
|---|---|---|---|
|Upload MP3|file|`audio.mp3_bed.enabled=true` + `audio.mp3_bed.source`|sourceは実装依存（file ref）|
|Remove MP3|action|`audio.mp3_bed.enabled=false`||
|Preview Segment：Auto|enum|`audio.mp3_bed.preview_segment.policy="auto_mid"`||
|Auto位置|number|`audio.mp3_bed.preview_segment.auto_mid_ratio`|既定0.30|
|Preview Segment：Pick|enum|`audio.mp3_bed.preview_segment.policy="pick"`||
|Pick start(mm:ss)|number|`audio.mp3_bed.preview_segment.pick_start_sec`|Pick時のみ|

---

## 6) Export長とMP3の扱い

|UI|型|JSON|備考|
|---|---|---|---|
|Export Duration（15/30/60/180）|enum/number|`export.duration_sec`||
|Export Policy：秒数優先|enum|`audio.mp3_bed.export_segment.policy="fit_export"`|推奨|
|Export Policy：MP3長に合わせる|enum|`audio.mp3_bed.export_segment.policy="match_mp3"`|MP3あり時のみ|
|MP3短い時のループ|bool|`audio.mp3_bed.looping.enabled`|デフォtrue|
|クロスフェード秒|number|`audio.mp3_bed.looping.crossfade_sec`|固定1.5推奨|

---

## 7) 映像調整（Basic）

|UI|型|JSON|備考|
|---|---|---|---|
|Theme Strength（0-100）|int|`video.overrides.theme_strength`|**追加フィールド**（下記参照）|

### video.overrides（新規：プリセットに対する上書き）

プリセットIDだけだと“調整値”が残らないので、Project JSONに上書き領域を追加します。

`"video": {   "preset_id": "P528_REPAIR_v1",   "overrides": {     "theme_strength": 50,     "advanced": {       "depth": 50,       "motion": 50,       "contrast": 50     }   } }`

---

## 8) 映像調整（Advanced：折りたたみ）

|UI|型|JSON|備考|
|---|---|---|---|
|Depth（0-100）|int|`video.overrides.advanced.depth`|可動域は内部で狭く|
|Motion（0-100）|int|`video.overrides.advanced.motion`|0.8〜1.2相当にマップ|
|Contrast（0-100）|int|`video.overrides.advanced.contrast`|±10%相当にマップ|

---

## 9) 音ミキサー（必須）

|UI|型|JSON|備考|
|---|---|---|---|
|MP3 Volume（0-100）|int|`audio.mixer.gain_mp3`|MP3なしでも保持可|
|Tone Volume（0-100）|int|`audio.mixer.gain_tone`|ソルフェジオ|
|Extra Volume（0-100）|int|`audio.mixer.gain_extra`|B/Cのみ|
|Master（0-100）|int|`audio.mixer.gain_master`|任意だが推奨|

### Ducking（任意）

|UI|型|JSON|備考|
|---|---|---|---|
|Tone Ducking（0-100）|int|`audio.mixer.ducking.amount`|enabled=true|
|Ducking ON/OFF|bool|`audio.mixer.ducking.enabled`|デフォON推奨|

---

## 10) 安全設定（UIに出さない）

|UI|JSON|備考|
|---|---|---|
|（なし）|`audio.safety.limiter_enabled=true`|常時|
|（なし）|`audio.safety.limiter_ceiling_db=-1.0`|常時|
|（なし）|`audio.safety.max_extra_gain_cap=20`|常時|

---

## 11) プレビュー/判定/エクスポートの状態

|UI|型|JSON|備考|
|---|---|---|---|
|Generate Preview (10s)|action|`preview`ジョブ生成|JSON自体は同じ、実行パラメータがpreview|
|判定チェック（YES/NO）|state|`ui_state.review.*`|保存しても良い（任意）|
|Export Full|action|`export`ジョブ生成|preview合格時のみ|

`ui_state` は保存しなくても良いですが、「前回どこが×だったか」残すなら便利。

---

# 完全な Project JSON（最小ひな形）

`{   "project_version": "1.0",   "video": {     "preset_id": "P528_REPAIR_v1",     "overrides": {       "theme_strength": 50,       "advanced": { "depth": 50, "motion": 50, "contrast": 50 }     }   },   "audio": { "...Audio JSON Spec v1..." : true },   "preview": { "duration_sec": 10, "resolution": [1080,1920], "fps": 30 },   "export": {     "duration_sec": 60,     "resolution": [1080,1920],     "fps": 30,     "format": "mp4_h264_aac",     "filename_template": "AuraLoop_{hz}_{mode}_{goal}_{dur}s_{datetime}.mp4"   } }`

---

次は、これを元に **「画面ワイヤーフレーム（テキスト）」** を作って、どこに何を置くかを確定します。  
（あなたがイメージを掴みやすいように、実際の配置をASCIIで描きます）

はい

了解。では **1画面完結UI**のワイヤーフレーム（テキスト/ASCII）を作って、配置を確定します。  
（「何がどこにあるか」「表示条件」が一目で分かる版）

---

# ワイヤーフレーム v1（1画面完結）

`┌───────────────────────────────────────────────────────────────┐ │ AuraLoop Studio  [Preview: 10s | 1080x1920 | 30fps | Loop ON]  │ │ Status: (Idle / Generating Preview... / Preview Ready / Exporting...) │ ├───────────────────────────────────────────────────────────────┤ │                         VIDEO PREVIEW                          │ │  ┌─────────────────────────────────────────────────────────┐  │ │  │                                                         │  │ │  │                 (9:16 Live Preview Canvas)               │  │ │  │                                                         │  │ │  └─────────────────────────────────────────────────────────┘  │ │  [Generate Preview (10s)]   [Export Full] (disabled until PASS)│ ├───────────────────────────────────────────────────────────────┤ │ LEFT: CONTROLS                                RIGHT: REVIEW    │ │ ┌──────────────────────────────┐          ┌──────────────────┐ │ │ │ 1) SOLFEGGIO (Theme Master)   │          │ 10s REVIEW SHEET │ │ │ │ [396] [417] [528] [639]       │          │ (auto changes by │ │ │ │ [741] [852]                   │          │  selected theme) │ │ │ │ Selected: 528 Repair          │          │                  │ │ │ ├──────────────────────────────┤          │ A. Visual (8)     │ │ │ │ 2) AUDIO MODE                 │          │ [ ] Loop natural │ │ │ │ ( ) A Solfeggio only          │          │ [ ] No flicker   │ │ │ │ ( ) B + Binaural              │          │ [ ] Not tiring   │ │ │ │ ( ) C + Schumann(7.83)        │          │ [ ] Small OK     │ │ │ │                              │          │ [ ] No moire     │ │ │ │ B only: Goal                  │          │ [ ] Not neon     │ │ │ │ [Sleep][Medit][Relax][Focus]  │          │ [ ] No accel     │ │ │ │ [Peak]                        │          │ [ ] Stable gaze  │ │ │ │ Notes: (Headphones recommended)          │                  │ │ │ ├──────────────────────────────┤          │ B. Theme (3)      │ │ │ │ 3) MP3 BED (optional)         │          │ 528 Repair card: │ │ │ │ [Upload MP3]  [Remove]        │          │ [ ] Gather+align │ │ │ │ File: healing_song.mp3 (03:42)│          │ [ ] Clear core   │ │ │ │ Preview segment: (•) Auto     │          │ [ ] Return loop  │ │ │ │                 ( ) Pick      │          │                  │ │ │ │ Pick start: 01:10 (enabled if Pick)     │ C. Audio (3)     │ │ │ ├──────────────────────────────┤          │ [ ] MP3 is main   │ │ │ │ 4) VISUAL (Basic)             │          │ [ ] Tone exists  │ │ │ │ Theme Strength  [====|-----]  │          │ [ ] Extra is thin│ │ │ │ (Single slider; safe-mapped)  │          │                  │ │ │ │ [Advanced ▾] (collapsed)      │          │ Result: PASS/FAIL│ │ │ │  Depth    [==|-------]        │          │ If FAIL: show    │ │ │ │  Motion   [==|-------]        │          │ "Adjust 1 slider"│ │ │ │  Contrast [==|-------]        │          │ instructions     │ │ │ ├──────────────────────────────┤          └──────────────────┘ │ │ │ 5) AUDIO MIXER                │                             │ │ │ MP3 Volume    [=====|----]    │                             │ │ │ Tone Volume   [==|-------]    │                             │ │ │ Extra Volume  [=|--------] (B/C only)                       │ │ │ Master        [====|-----]    │                             │ │ │ Tone Ducking  [==|-------] (optional, default ON)           │ │ │ [Preset: Safe] [Balanced] [Tone Forward]                    │ │ ├──────────────────────────────┤                             │ │ │ 6) EXPORT                      │                             │ │ │ Duration: [15s][30s][60s][180s]│                             │ │ │ Policy: (•) Fit export seconds │                             │ │ │         ( ) Match MP3 length   │ (enabled if MP3 uploaded)   │ │ │ (Auto rule: MP3 short -> Loop + Crossfade 1.5s)              │ │ ├──────────────────────────────┤                             │ │ │ 7) RESET / UNDO               │                             │ │ │ [Reset Visual] [Reset Audio]  │ [Reset All] [Undo]          │ │ └──────────────────────────────┘                             │ └───────────────────────────────────────────────────────────────┘`

---

# 表示条件（実装にそのまま使える）

- **Export Full**：`PASS` のときだけ enabled
    
- **Goal（Binaural）**：Mode B のときだけ表示
    
- **Extra Volume**：Mode B/C のときだけ表示
    
- **Match MP3 length**：MP3アップロード時だけ選択可能
    
- **Pick start**：Preview segment が Pick のときだけ有効
    
- **Advanced**：折りたたみ（初期は閉）
    

---

# “FAIL時のガイダンス文”テンプレ（右欄に出す）

FAIL時に、右欄の最下部に **次の1行だけ**出します（沼防止）：

- 映像FAIL → `Adjust Theme Strength only.`（まずこれ）
    
- 音FAIL → `Lower Tone Volume first.`（次にこれ）
    
- Extra不快 → `Lower Extra Volume.`（即）
    

（詳細は“ヘルプ”に押し込む）

---

# 次のステップ（最終：あなたの不安を潰す）

ここまでで UIの形が確定したので、最後に **「ダミー出力（完成物の想像）」**を文章で作ります。

- 例：528 / Mode B Focus / MP3あり / 60秒  
    → “どんな動画・どんな音になるか” を具体描写（商品説明にも転用可）
    

続けて、その **完成物の具体描写テンプレ** を作ります。

はい

了解。では「**完成物を先に想像して合否を決める**」ための、**完成物具体描写テンプレ**を作ります。  
これはそのまま「商品説明」「生成結果の説明」にも転用できます。

---

# 完成物具体描写テンプレ（1本につき30〜60秒で書ける）

## 0) 生成条件（ヘッダー）

- 周波数（映像テーマ）：{Hz} / {ThemeName}
    
- 音モード：{A|B|C}（Bなら目的：{Goal} / CならSchumann）
    
- MP3：{あり/なし}（ファイル名：{mp3_name}）
    
- 出力：{duration}s / 1080×1920 / 30fps / Loop
    

---

## 1) 映像（3文だけ：見た瞬間に分かる描写）

**① 第一印象（1文）**

- 例：「中心に澄んだ核が生まれ、周囲の粒子が静かに揃っていく。」
    

**② 10秒の中の“変化点”（1文）**

- 例：「中盤で粒子の流れが同じ方向に揃い、整う瞬間が一度だけ訪れる。」
    

**③ ループの自然さ（1文）**

- 例：「終点で演出が止まらず、切れ目なく最初の状態へ戻る。」
    

> この3文で「何が映っているか」「どう動くか」「ループ品質」が確定します。

---

## 2) 音（3文だけ：聴感の合格ライン）

**① MP3（主役）の聴こえ方（1文）**

- 例：「音楽の芯はそのまま残り、雰囲気を壊さずに鳴っている。」
    

**② ソルフェジオ（存在感）の聴こえ方（1文）**

- 例：「トーンは薄く重なって“入っている”のが分かるが、刺さりはない。」
    

**③ Extra（バイノーラル/シューマン）の気配（1文）**

- 例：「うねりは主張せず、底に静かなリズムだけが残る。」
    

---

## 3) 体感タグ（3つだけ）

- 映像タグ：{重い/澄む/上がる/溶ける/整う/晴れる}
    
- 音タグ：{丸い/輪郭/静寂/低く安定/微振動/軽い冴え}
    
- 用途タグ：{睡眠前/瞑想/休憩/集中/リセット/浄化}
    

---

## 4) NGチェック（1行）

- 例：「点滅が主役になっていない／曲が消えていない／Extraで不快が出ていない。」
    

---

# 具体例（あなたがイメージしやすい完成物サンプル）

## 例1：528Hz / Mode B Focus / MP3あり / 60秒

### 映像（3文）

1. 中心に澄んだ核が生まれ、粒子がゆっくり中心へ寄っていく。
    
2. 中盤で粒子の向きが揃い、“整う”瞬間が一度だけ現れる。
    
3. 最後は整い切ったまま終わらず、わずかに散って自然に冒頭へ戻る。
    

### 音（3文）

1. ヒーリング音楽の旋律や空気感は主役のまま保たれている。
    
2. 528Hzのトーンが薄く重なり、存在は分かるが耳に刺さらない。
    
3. Focusのバイノーラルは控えめで、輪郭が少し立つ程度に留まる。
    

### タグ

- 映像：整う／澄む
    
- 音：輪郭／静寂
    
- 用途：集中／作業前の整え
    

---

## 例2：852Hz / Mode C Schumann / MP3あり / 180秒

### 映像（3文）

1. 余白が美しく、少量の星屑が奥行きの中で静かに上昇する。
    
2. 遠景の膜が一度だけ呼吸し、空気の透明感がふっと増す。
    
3. 粒子は抜け続けず循環し、ループの切れ目が見えない。
    

### 音（3文）

1. MP3は空間の土台として自然に聴こえ続ける。
    
2. 852Hzは透明な光のように薄く重なり、邪魔をしない。
    
3. 7.83Hzの揺れは“気配”として底にあり、不快なうねりは出ない。
    

### タグ

- 映像：上がる／神秘
    
- 音：微振動／静寂
    
- 用途：瞑想／寝る前
    

---

# 使い方（運用ルール）

- プレビューが出たら、このテンプレを **埋めて書けるか** を見る
    
- 書けない（言語化できない）＝完成物が曖昧＝仕様がブレてるサイン
    
- 書けるなら、その生成物は“商品化できる”可能性が高い
    

---

次は、このテンプレをUIに組み込みやすくするために、  
**「自動生成される説明文（短文）」**の定型を作ります。  
（例：`528Hz / Focus / MP3: on / Tone: 20 / Extra: 8` → 2行で説明）

はい

了解。では **UIで自動生成できる“説明文（短文）”テンプレ**を作ります。  
「生成物を見なくても、どんな仕上がりを狙っているか」が2行で分かるやつです。

---

# 自動説明文テンプレ（2行）

## 1行目（条件の要約）

`{Hz}Hz / {ThemeName} | Mode {A|B|C}{(Bなら: Goal)} | MP3: {ON/OFF} | {duration}s`

## 2行目（狙いの言語化：テーマ＋音の合成）

- テーマ文（固定）＋ 音文（固定）を連結するだけ
    

---

# テーマ文（Hzごとに固定：1フレーズ）

- **396 Ground**：`重心を下へ。沈む静けさで定着させる映像。`
    
- **417 Reset**：`絡みをほどき、透明に戻す“切り替え”の映像。`
    
- **528 Repair**：`中心核に集まり、粒子が揃って整う映像。`
    
- **639 Harmony**：`境界が丸くなり、ふたつが溶け合う映像。`
    
- **741 Clear**：`霧が抜け、澄んでいく透明感の映像。`
    
- **852 Intuition**：`余白と奥行き。星屑が上へ昇る神秘の映像。`
    

---

# 音文（Mode別に固定：1フレーズ）

## Mode A（Solfeggioのみ）

- MP3 ON：`音楽を主役に、ソルフェジオを薄く重ねます。`
    
- MP3 OFF：`ソルフェジオ単体で、刺さらないトーンを鳴らします。`
    

## Mode B（Binaural）

- MP3 ON：`音楽を主役に、目的別バイノーラルを“薄く”追加します。`
    
- MP3 OFF：`ソルフェジオに、目的別バイノーラルを重ねます。`
    

## Mode C（Schumann）

- MP3 ON：`音楽を主役に、7.83Hzの揺れを“気配”として加えます。`
    
- MP3 OFF：`ソルフェジオに、7.83Hzの揺れを薄く重ねます。`
    

---

# 目的（Goal）一言タグ（Bのみ）

2行目の末尾に付ける短い一言（任意）

- Sleep：`（丸く沈む）`
    
- Meditation：`（内側に静まる）`
    
- Relax：`（ほどける）`
    
- Focus：`（輪郭が立つ）`
    
- Peak：`（軽く冴える）`
    

---

# 具体例（UIで実際に出る形）

## 例1：528 / B Focus / MP3 ON / 60s

1行目：  
`528Hz / Repair | Mode B: Focus | MP3: ON | 60s`  
2行目：  
`中心核に集まり、粒子が揃って整う映像。音楽を主役に、目的別バイノーラルを“薄く”追加します。（輪郭が立つ）`

## 例2：852 / C / MP3 ON / 180s

1行目：  
`852Hz / Intuition | Mode C | MP3: ON | 180s`  
2行目：  
`余白と奥行き。星屑が上へ昇る神秘の映像。音楽を主役に、7.83Hzの揺れを“気配”として加えます。`

---

# UI埋め込みの小技（迷い防止）

説明文の下に、**今のミキサー値を1行だけ**出します（任意）。

`Mix: MP3 {gain_mp3} / Tone {gain_tone} / Extra {gain_extra} / Master {gain_master}`  
※ExtraはB/Cのみ表示

---

次は、ここまでの短文をそのまま使って、  
**「Export時にファイル内メタ情報として保存する項目（埋め込み用の文字列）」**を定義します。  
（後から“どの設定で作ったか”追えるようにする）

はい

了解。では **ExportしたMP4に埋め込む（または隣に保存する）メタ情報**を仕様として定義します。  
狙いは「あとから見返しても、**どの設定で作ったか一瞬で復元できる**」ことです。

---

# メタ情報仕様 v1（おすすめは2系統）

MP4に“確実に残す”方法は環境差が出やすいので、MVPでは **両方**を推奨します。

1. **MP4コンテナのメタ**（入れられる範囲で）
    
2. **サイドカーJSON**（確実・完全復元用） ←最重要
    

---

# 1) MP4に入れるメタ（最小セット）

## フィールド（短く、壊れにくく）

- `title`：`AuraLoop {Hz} {ThemeName}`
    
- `comment`：自動説明文2行を1行に圧縮したもの
    
- `artist`：`AuraLoop Studio`
    
- `date`：生成日時（YYYY-MM-DD HH:MM）
    

### comment の例（1行圧縮）

`528Hz Repair | Mode B Focus | MP3 ON | Dur 60s | Mix MP3 70 Tone 20 Extra 8 Master 70 | Preset P528_REPAIR_v1`

> 長文は入れない。ここは「識別と概要」だけ。

---

# 2) サイドカーJSON（完全復元用・必須）

MP4と同名で保存します。

- 動画：`AuraLoop_528_B_Focus_60s_20251224_2030.mp4`
    
- JSON： `AuraLoop_528_B_Focus_60s_20251224_2030.json`
    

## 中身（Project JSONをそのまま保存）

- `project_version`
    
- `video`（preset_id + overrides）
    
- `audio`（Audio Spec）
    
- `export` / `preview`
    
- `app_version`（あとで互換性確認に役立つ）
    

### サイドカーJSON例（骨格）

`{   "app": { "name": "AuraLoop Studio", "version": "0.1.0" },   "generated_at": "2025-12-24T20:30:00+09:00",   "project": {     "project_version": "1.0",     "video": {       "preset_id": "P528_REPAIR_v1",       "overrides": { "theme_strength": 50, "advanced": { "depth": 50, "motion": 50, "contrast": 50 } }     },     "audio": {       "audio_spec_version": "1.0",       "mode": "B",       "mp3_bed": {         "enabled": true,         "source": { "type": "file", "name": "healing_song.mp3", "hash": "sha256:..." },         "preview_segment": { "policy": "auto_mid", "auto_mid_ratio": 0.3 },         "export_segment": { "policy": "fit_export" },         "looping": { "enabled": true, "crossfade_sec": 1.5 },         "stereo_mode": "preserve"       },       "tone_solfeggio": { "enabled": true, "hz": 528, "waveform": "sine", "phase_lock": true },       "extra": { "enabled": true, "type": "binaural", "goal": "focus", "carrier_hz": 200, "beat_hz": 16, "stereo": "binaural_lr" },       "mixer": { "gain_mp3": 70, "gain_tone": 20, "gain_extra": 8, "gain_master": 70,         "ducking": { "enabled": true, "target": "tone", "amount": 20, "attack_ms": 40, "release_ms": 220 } },       "safety": { "limiter_enabled": true, "limiter_ceiling_db": -1.0, "max_extra_gain_cap": 20 }     },     "export": { "duration_sec": 60, "resolution": [1080,1920], "fps": 30, "format": "mp4_h264_aac" },     "preview": { "duration_sec": 10, "resolution": [1080,1920], "fps": 30 }   } }`

### source.hash を入れる理由

- MP3が差し替わった時に「同じ設定なのに違う音」問題を切り分けできる
    

---

# 3) UIでの扱い（迷わない導線）

Export完了後に、完了ダイアログで **2つだけ**表示：

- ✅ `Saved: ...mp4`
    
- ✅ `Saved settings: ...json`
    

そしてボタンは

- `Open Folder`
    
- `Reopen Settings`（jsonを読み込んで復元）
    

---

# 4) “復元”の仕様（重要）

- JSONを読み込んだら、UIの全項目がそのまま再現される
    
- MP3が見つからない場合は警告：
    
    - `MP3 missing: please re-link`（再指定できる）
        
    - それでも生成は可能（MP3 OFF扱い）
        

---

次は、MVPの最後の詰めとして  
**「設定の保存/読み込み（プリセット＋プロジェクト）」のユーザー体験**を定義します。  
（保存はワンクリック、読み込みはドラッグ＆ドロップ、みたいな運用）

はい

了解。では **設定の保存/読み込み（プリセット＋プロジェクト）UX** を、MVPにちょうど良い“迷わない”形で定義します。  
（目的：同じ設定を再利用、量産、微調整、復元が一瞬）

---

# 保存/読み込み UX 仕様 v1

## 保存するものは2種類だけ

1. **Project（1本分の完全な設定）**：mp4と同名の`.json`（復元用）
    
2. **User Preset（自分の定番配合）**：名前付きテンプレ（複数保存）
    

---

# 1) Project（完全復元）— 自動保存が基本

## タイミング

- **Export完了時に自動保存**（同名の`*.json`を必ず作る）
    
- プレビュー段階では保存しない（散らからない）
    

## ファイル

- `AuraLoop_...mp4`
    
- `AuraLoop_...json`（Project JSON）
    

## UI

Export完了ポップアップ：

- ✅ Saved MP4
    
- ✅ Saved settings JSON
    
- [Open Folder] [Reopen Settings]
    

---

# 2) User Preset（定番配合）— ワンクリック保存

ユーザーが欲しいのは「毎回同じ配合を呼び出したい」なので、ここは軽く。

## 保存対象（音が中心）

- Audio Mode（A/B/C）
    
- BならGoal
    
- ミキサー（MP3/Tone/Extra/Master/Ducking）
    
- プレビュー区間（Auto/Pickの設定）
    
- （任意）Theme Strength（映像1本だけ）も含めてOK
    

※MP3ファイル参照は含めない（環境依存だから）

## UI配置

Audio Mixerの近くに小さく：

- [Save Preset]
    
- ドロップダウン：[Load Preset ▼]（最大10〜20でもOK）
    

## 保存フロー（迷わせない）

[Save Preset]押下 → 小さい入力欄だけ出る

- Name：`My Safe Mix`（例）
    
- Include Visual Strength：ON/OFF（初期OFF）
    
- [Save]
    

---

# 読み込み UX（2経路）

## A) ドラッグ＆ドロップ（最速）

画面全体で受け付ける。

- `*.json` をドロップ → **Projectとして復元**
    
- `*.mp3` をドロップ → **MP3として読み込み**
    
- `*.mp4` はドロップしても無視でOK（ややこしいので）
    

### Project復元時の挙動

- UIの全項目を一括反映
    
- MP3がJSON内に記録されてるがファイルが見つからない場合：
    
    - バナー表示：`MP3 not found. Please re-link.`
        
    - [Re-link MP3] ボタン（クリックで再指定）
        

## B) メニュー/ボタンから開く（通常）

上部右あたりに小さく：

- [Open Project]（jsonを選ぶ）
    
- [Import MP3]
    
- [Export Folder]（出力先選択）
    

---

# “プリセット”と“プロジェクト”の差を混同させない文言

UI文言を固定して迷いを消します。

- Project：**Open Project / Saved settings**
    
- Preset：**Save Preset / Load Preset**
    

“Preset”を“Project”と同列に見せない（別物）

---

# バージョン互換（MVPでも入れる）

JSONに入れておく：

- `project_version`
    
- `app.version`
    

読み込み時に

- 同一メジャー（1.x）ならOK
    
- 違うなら警告（読み込みは試すが注意を出す）
    

---

# 量産（将来拡張）を見据えた小さな仕込み

MVPではUIに出さなくても良いけど、Project JSONに入れられると後で便利：

- `batch`：同設定で複数Hzを回す等（将来の一括生成）
    

---

## 最終的にユーザーができること（MVPの体験）

1. MP3を入れる
    
2. ソルフェジオ＆モードを選ぶ
    
3. ミキサーを少し触る
    
4. 10秒プレビュー→判定→OK
    
5. Export → MP4＋JSONが自動で残る
    
6. 後日JSONをドラッグ → 100%再現
    

---

次は、ここまでの仕様で **“最初に作るべき開発タスクの分解（チェックリスト）”** を出します。  
（前回みたいに作り込んでからズレるのを防ぐため、最短で形を見れる順に並べます）

はい

了解。では「作り込んでからズレる」を防ぐために、**最短で“完成物の質”を確認できる順**にタスクを分解します。  
（＝まず10秒プレビューが出て、音ミックスと映像ループの合否が判定できるところまで）

---

# 開発タスク分解（MVP：最短確認ルート）

## Phase 0：土台（まず動かす）

1. **Project JSONモデル定義**（video/audio/export/preview/ui_state）
    
2. **UI骨格（1画面）**：Preview枠 / Controls枠 / Review枠 / 2ボタン（Preview/Export）
    
3. **設定のリアルタイム反映**（UI → Project JSON マッピング）
    

✅ この時点で「UIで選んだ値がJSONに入る」まで。

---

## Phase 1：10秒“映像だけ”でループを成立させる（最重要）

4. **Video Engine 最小実装**（Canvas/Three/ShaderどれでもOK）
    
    - 1080×1920 / 30fps で描画できる
        
5. **10秒ループ時間管理**（phase = 2πt/10 の周期）
    
6. **Preset 1本だけ実装（741 Clear 推奨）**
    
    - 背景＋霧（haze）＋少量粒子
        
    - Theme Strength → haze_amount だけ効かせる
        
7. **Preview生成（10秒）**：UI上で即再生（ループON）
    

✅ ここで「ループが自然か」「画が成立するか」を最速で判定できる。

---

## Phase 2：音ミキサー（MP3 + Tone）を先に成立

8. **MP3アップロード & 再生**（プレビュー再生の土台）
    
9. **Tone（ソルフェジオ正弦波）生成**（dual_mono）
    
10. **ミキサー実装**（MP3 Volume / Tone Volume / Master）
    
11. **10秒プレビューに音を合成して再生**
    
12. （任意だけど強い）**Limiter（内部）**で割れ防止
    

✅ ここで「MP3主役のままトーンが入るか」を確認できる。

---

## Phase 3：B/C（Extra）追加と安全策

13. **Extra（Binaural）実装**（carrier + beat）
    
    - Goal → beat_hz の固定表
        
14. **Schumann（7.83）実装**（C固定）
    
15. **Extra Volume** と **max cap**（上限20相当）で事故防止
    
16. （任意）**Tone Ducking**（MP3主役を守る）
    

✅ ここで「不快なうねりが出ない薄さ」をチューニングできる。

---

## Phase 4：映像プリセットを4本に拡張（MVP先行4本）

17. **396 Ground**（沈降循環：粒子密度下部）
    
18. **528 Repair**（中心核：引力＋整列）
    
19. **852 Intuition**（余白＋上昇循環）
    
20. **Theme Strength の安全マッピング**（盛りすぎ防止）
    

✅ ここで“商品としての見栄え”が揃う。

---

## Phase 5：Reviewシート（合否ゲート）実装

21. **Review UI表示**（映像8項目＋テーマ3項目＋音3項目）
    
22. **PASS/FAILの状態管理**（Exportボタン制御）
    
23. FAIL時の **1手ガイダンス表示**
    

- 映像：Theme Strength
    
- 音：Tone Volume → Extra Volume の順
    

✅ ここで「迷い」が消える（沼が止まる）。

---

## Phase 6：Export（短時間→長時間）と保存/復元

24. **Exportエンジン**（MP4書き出し：H.264/AAC）
    
25. **Exportプリセット（15/30/60/180）**
    
26. **MP3短い時のループ＋クロスフェード（1.5s固定）**
    
27. **サイドカーJSON自動保存（完全復元）**
    
28. **Open Project（json読み込み）**（MP3 missingはre-link）
    

✅ ここで“量産”ができる。

---

# “ズレを最小化する”検証ポイント（各Phaseの合格条件）

## P1合格：映像

- 741で「霧が抜ける」が分かる
    
- 10秒ループで切れ目が見えない
    

## P2合格：音

- MP3が主役のまま
    
- Toneが薄く“いる”のが分かる
    

## P3合格：Extra

- Extraを入れても不快が出ない（薄い）
    
- Goalで差が“説明できる程度”にある
    

## P4合格：4本

- 396：重い／沈む
    
- 528：整う
    
- 741：澄む
    
- 852：余白と奥行き
    

## P6合格：商品化

- 60秒と3分が安定出力
    
- JSONで復元できる
    

---

# 最初に作るべき“1週間の最小セット”（最短で答えが出る）

- Phase 1（741映像ループ）
    
- Phase 2（MP3 + Toneミキサー）
    
- Phase 6の一部（15秒Exportだけ先に）
    

これで「完成物が想像通りか」を最速で確認できます。

---

次は、このタスク分解に合わせて、**Phase1〜2の受け入れテスト（具体チェック項目）**を作ります。  
（開発が進んだ時に“何がOKなら次へ進めるか”が明確になります）

はい

了解。では **Phase1〜2（映像ループ＋MP3+Toneミキサー）**の受け入れテストを、チェックリスト形式で作ります。  
これで「どこまでできたら次へ進むか」が明確になります。

---

# 受け入れテスト（Phase 1：映像ループ / 741 Clear）

## A. 描画・基本

-  1080×1920で描画できる（プレビュー枠に表示）
    
-  30fps相当で滑らかに動く（ガクつきが致命的でない）
    
-  10秒プレビューが生成・再生できる（ボタン押下→表示）
    

## B. ループ品質（最重要）

-  10秒終了→0秒へ戻っても“切れ目”が分からない
    
-  粒子数/霧が「増え続ける」「減り続ける」挙動がない（総量一定）
    
-  ループ境界で色・明るさが跳ねない
    

## C. 741テーマ成立（見た瞬間の合否）

-  “霧が抜ける”変化が分かる（曇り→澄み）
    
-  シャープすぎてテックっぽくならない（輪郭は“少し”）
    
-  青の高コントラストで刺さらない（上品）
    

## D. Theme Strength（Basic 1本）

-  スライダーで変化が出る（霧の厚みが変わる）
    
-  0〜100にしても別物にならない（内部で安全マッピングされている）
    
-  0にしても霧が完全消失しない（テック化防止）
    

## E. 安全（見た目の事故防止）

-  点滅が主役にならない（キラキラ点滅なし）
    
-  モアレ/チラつきが極端に出ない（縮小しても破綻しない）
    

### Phase1合格条件（GO判定）

- **ループ切れ目なし**（Bが全部OK）
    
- 741の“澄む”が成立（Cが2/3以上OK）
    
- Theme Strengthが効くが壊れない（Dが全部OK）
    

---

# 受け入れテスト（Phase 2：MP3 + Tone ミキサー）

## A. MP3アップロード・再生

-  MP3を読み込める（ファイル名と長さが表示される）
    
-  MP3をプレビュー再生できる（再生/停止が動く）
    
-  Removeで解除できる（MP3 OFF状態に戻る）
    

## B. プレビュー区間（Auto）

-  Autoで中盤（例：30%地点）から10秒が選ばれる
    
-  10秒プレビューと音が同期している（動画だけ/音だけ遅れない）
    
-  MP3が短くても破綻しない（短い場合はループ or 末尾無音のどちらかで一貫）
    

## C. Tone（ソルフェジオ正弦波）

-  選んだHzのToneが鳴る（396/528等に切替可能）
    
-  Toneは左右同一（dual_mono）
    
-  位相が暴れない（プレビュー再生のたびに違和感が出ない）
    

## D. ミキサー（MP3 / Tone / Master）

-  MP3 Volume が効く（0でMP3が消える）
    
-  Tone Volume が効く（0でToneが消える）
    
-  Master が効く（全体の音量が変わる）
    
-  “曲が消える事故”が起きにくい初期値になっている  
    例：MP3 70 / Tone 20 / Master 70
    

## E. 割れ/クリップ対策（最低限）

-  Toneを上げても極端に割れない（内部Limiterがある or 安全ゲイン）
    
-  Masterを100にしても破綻しにくい（完全保証は不要、事故頻度が低い）
    

## F. UIゲート（最小）

-  Generate Preview を押すと「10秒動画＋10秒音」の完成プレビューが出る
    
-  設定変更→再プレビューが反映される（キャッシュが残って混乱しない）
    

### Phase2合格条件（GO判定）

- MP3が主役のまま鳴る（Dの初期値で成立）
    
- Toneが薄く“いる”のが分かる（C/Dで確認できる）
    
- 10秒プレビューが音付きで安定再生（Fが全部OK）
    

---

# 追加：失敗時のデバッグ指針（1手で切り分け）

- 音が濁る → **Tone Volumeを0**にしてMP3単体で確認
    
- 音が小さい → **Masterだけ**上げる（まず1手）
    
- 同期がズレる → まず **動画単体 / 音単体**で再生確認
    
- ループ切れ目 → `phase`の周期処理と粒子循環（増減）を疑う
    

---

次は、Phase1〜2が通った前提で、**Phase3（Extra：バイノーラル/シューマン）の受け入れテスト**も同じ粒度で作ります。

はい

了解。では **Phase3（Extra：バイノーラル／シューマン）**の受け入れテストを同じ粒度で作ります。  
（狙い：Extraが入っても“不快にならない”“安全に薄く調整できる”）

---

# 受け入れテスト（Phase 3：Extra Binaural / Schumann）

## A. モード切替（A/B/C）

-  Mode A/B/C の切替でUIが正しく変わる
    
    - A：Goal非表示 / Extra Volume非表示 / extra.enabled=false
        
    - B：Goal表示 / Extra Volume表示 / extra.type=binaural
        
    - C：Goal非表示 / Extra Volume表示 / extra.type=schumann_binaural
        
-  Mode切替後、Generate Previewで結果が変わる（反映される）
    
-  Mode切替時に破綻しない（音が出ない／クラッシュしない）
    

---

## B. Extra生成（B：バイノーラル）

### B-1 生成仕様

-  carrier + beat のステレオ差で鳴っている（L=carrier / R=carrier+beat）
    
-  stereoは維持される（モノ化しない）
    
-  Extra Volumeを0にするとExtraが消える
    

### B-2 Goal → beat_hz の固定表

-  Goal切替でbeat_hzが正しく変わる
    
    - sleep 3.5 / meditation 6 / relax 10 / focus 16 / peak 40
        
-  目的を切り替えても破綻しない（ノイズ・音切れ・不連続が強く出ない）
    

### B-3 聴感の合格（“差はあるが薄い”）

-  デフォルト（Extra 8〜10）で不快が出ない
    
-  Goalを変えると“説明できる程度”に違いがある  
    ※強烈な違いは不要。むしろ出過ぎたらNG。
    
-  “うねりが気になる”場合、Extra Volumeを下げれば改善する（操作で救える）
    

---

## C. Extra生成（C：シューマン 7.83）

### C-1 固定仕様

-  beat_hzが**常に7.83**固定
    
-  carrierが固定（例200Hz）で安定している
    
-  stereo（binaural_lr）が維持される
    

### C-2 聴感の合格（“気配として底にある”）

-  デフォルト（Extra 8〜10）で不快が出ない
    
-  Extra Volumeを上げると“うねり感”が増えるが、上げすぎはキャップで抑えられる
    
-  Extra Volumeを下げると即改善する（操作で救える）
    

---

## D. 安全キャップ（事故防止）

-  Extra Volumeを100にしても、内部キャップで「入れすぎ」になりにくい  
    例：`max_extra_gain_cap=20` 相当
    
-  Peak（40Hz）でも耳障りになりにくい（キャップが効いている）
    
-  Limiter（-1dB等）でクリップしにくい（割れが頻発しない）
    

---

## E. Ducking（任意だが推奨）

-  Ducking ONで、MP3が鳴っている間はToneが少し引っ込む
    
-  Ducking OFFで、Toneが常に同じレベル
    
-  Ducking Amountを上げ下げしても不自然なポンピングになりにくい
    

---

## F. UI注意文（誤解防止）

-  Mode B/C のときだけ「イヤホン推奨」文言が表示される
    
-  免責の短文が常に表示できる（音量調整／違和感時は下げる）
    

---

## G. 10秒プレビューの合格判定（Audio OKカード）

-  MP3 is main（曲が消えてない）
    
-  Tone exists（トーンが薄く“いる”）
    
-  Extra is thin（不快が出ない）
    
-  不快が出たら **Extra Volume↓** で救える（最重要）
    

---

# Phase3合格条件（GO判定）

- **B/C どちらでも、デフォルト値で不快が出ない**
    
- 目的切替やMode切替で破綻しない
    
- Extraを下げれば“救える”（調整で回復できる）
    
- Extra上げすぎ事故がキャップで防げる（安全）
    

---

# デバッグ最短手順（不具合が出た時）

1. Extra Volume = 0（Extraを完全に切る）  
    → これで直るならExtra生成/合成が原因
    
2. Tone Volume = 0（Toneも切る）  
    → MP3単体で正常なら合成側
    
3. MP3 OFF（トーン単体＋Extra単体で確認）  
    → どのレイヤーが悪いか切り分け
    

---

次は、Phase3まで通った前提で、**Phase6（Export/保存/復元）**の受け入れテスト（15s→60s→180s）を作ります。

はい

了解。では **Phase6（Export / 保存 / 復元）**の受け入れテストを、15s→60s→180sの順で“確実に商品化できる”粒度で作ります。

---

# 受け入れテスト（Phase 6：Export / 保存 / 復元）

## A. Export基本（15秒）

### A-1 書き出し成功

-  Export Duration「15s」でMP4が生成される
    
-  解像度が1080×1920、FPSが30になっている
    
-  音が入っている（MP3 + Tone、B/CならExtraも）
    
-  再生して途中で止まらない（破損していない）
    

### A-2 命名と保存先

-  ファイル名がテンプレ通りになる  
    例：`AuraLoop_528_B_Focus_15s_YYYYMMDD_HHMM.mp4`
    
-  出力先フォルダに保存される
    
-  Export完了後に「Open Folder」が機能する（任意でも可）
    

### A-3 サイドカーJSON（必須）

-  同名の`.json`が自動生成される
    
-  JSONに `app.version` / `generated_at` / `project` が入っている
    
-  JSONの `project.video/audio/export` がUIの設定と一致する
    

✅ **Phase6の最短合格は「15秒Exportが安定」**です。

---

## B. Export拡張（60秒）

### B-1 安定性

-  60秒で最後まで書き出せる（途中で落ちない）
    
-  書き出し後のMP4が最後まで再生できる
    

### B-2 ループ品質（動画側）

-  10秒ループの映像が60秒でも破綻しない（増殖・劣化なし）
    
-  ループ境界が目立たない（少なくとも致命的でない）
    

### B-3 音の一貫性

-  MP3が主役のまま（後半でトーンが急に目立たない）
    
-  Tone/Extraの音量が時間経過で不自然に変動しない
    

---

## C. Export主力（180秒/3分）

### C-1 長尺の安定性

-  180秒が最後まで書き出せる
    
-  3分再生して映像/音が途切れない
    

### C-2 パフォーマンス（最低限）

-  書き出し中にUIが完全に固まって操作不能にならない（停止ボタンなくてもOK、落ちなければ）
    
-  メモリ不足で落ちない（最低限）
    

---

# D. MP3長が足りないケース（最重要：自動ループ＋クロスフェード）

## D-1 MP3短い < Export長

例：MP3が20秒、Exportが60秒

-  MP3が自動でループされる
    
-  つなぎ目に“段差”が出にくい（クロスフェードが効いている）
    
-  つなぎ目で音量が跳ねない（ポンッとしない）
    

## D-2 仕様固定の確認

-  クロスフェード秒数は固定（1.5秒）で一貫
    
-  UIで余計な選択肢を出していない（迷わせない）
    

---

# E. MP3長が長いケース（切り出し）

## E-1 Export長 < MP3長

例：MP3が5分、Exportが60秒

-  Auto（中盤30%）で切り出される
    
-  Pick（開始位置指定）が動く（実装する場合）
    
-  Pick指定が範囲外でも落ちない（末尾近くなら自動調整）
    

---

# F. 保存/復元（Project JSON）

## F-1 ドラッグ＆ドロップ復元

-  `.json`を画面にドロップすると設定が復元される
    
-  UIの全項目がJSONと一致する
    
-  復元後、Generate Previewが同じ系統の結果になる
    

## F-2 MP3が見つからないケース（必須）

-  JSON内のMP3参照が見つからないとき警告が出る
    
-  [Re-link MP3] で再指定できる
    
-  再指定後、元の設定で生成できる
    

## F-3 バージョン互換

-  project_versionが同一メジャーなら無警告で読み込み
    
-  互換性が怪しい場合、警告は出るが落ちない（読み込みは試行）
    

---

# G. メタ情報（任意：できたら良い）

## G-1 MP4メタ（最低）

-  title/comment/date が入る（可能なら）
    
-  commentが長すぎて欠けても、サイドカーJSONがあれば問題なし
    

---

# Phase6合格条件（GO判定）

- 15s/60s/180s がそれぞれ **安定して書き出せる**
    
- MP3短いケースで **自動ループ＋クロスフェードが自然**
    
- Export時に **必ずサイドカーJSONが残る**
    
- JSONドラッグで **設定が復元できる**（MP3 missingも救える）
    

---

# 不具合が出た時の切り分け（最短）

- MP4が壊れる → まず15sで再現するか
    
- 音だけおかしい → MP3 OFF / Tone 0 / Extra 0で段階切り分け
    
- つなぎ目が目立つ → クロスフェード秒数と実装位置を疑う
    
- 復元がズレる → UI→JSONマッピング表と `overrides` の反映漏れを確認
    

---

次は、これでMVPの全受け入れが揃ったので、最後に **「最初のデモ用セット（おすすめ設定4本）」**を作ります。  
（起動直後に“これなら良いものが出る”が一発で分かる、デモ兼テンプレ）

はい

了解。では **起動直後に一発で「良いものが出る」デモ用セット4本**を用意します。  
目的は「完成物の質」を最短で確認すること。**映像4本（396/528/741/852）× 音モードの相性が良い組み合わせ**にします。

---

# デモ用セット（おすすめ4本）

共通：

- Export：**60秒**
    
- Preview：10秒
    
- Mix初期：**Safe（MP3 70 / Tone 20 / Extra 8 / Master 70 / Ducking 20）**
    
- Theme Strength：50
    
- MP3：あればON（なければOFFでOK）
    

---

## Demo 1：396 Ground × Mode A（最も安全）

**狙い：重心・落ち着き。まず“事故が起きない”**

- Hz：396（P396_GROUND_v1）
    
- Mode：A（Solfeggio only）
    
- MP3：ON推奨
    
- Mix：
    
    - MP3 70 / Tone 20 / Master 70
        
    - Ducking 20
        

自動説明文（2行）：

- `396Hz / Ground | Mode A | MP3: ON | 60s`
    
- `重心を下へ。沈む静けさで定着させる映像。音楽を主役に、ソルフェジオを薄く重ねます。`
    

---

## Demo 2：528 Repair × Mode B Focus（違いが分かりやすい）

**狙い：整列・輪郭。Binauralの“薄い差”が確認しやすい**

- Hz：528（P528_REPAIR_v1）
    
- Mode：B（Binaural）
    
- Goal：Focus（beat 16Hz）
    
- MP3：ON推奨
    
- Mix：
    
    - MP3 70 / Tone 20 / Extra 8 / Master 70
        
    - Ducking 20
        

自動説明文：

- `528Hz / Repair | Mode B: Focus | MP3: ON | 60s`
    
- `中心核に集まり、粒子が揃って整う映像。音楽を主役に、目的別バイノーラルを“薄く”追加します。（輪郭が立つ）`
    

---

## Demo 3：741 Clear × Mode A（映像品質の判断用）

**狙い：霧が抜ける。映像の“上品さ”とループの良さが見える**

- Hz：741（P741_CLEAR_v1）
    
- Mode：A
    
- MP3：ONでもOFFでもOK（映像評価ならOFFでも良い）
    
- Mix：
    
    - MP3 70 / Tone 18 / Master 70（少し薄め）
        

自動説明文：

- `741Hz / Clear | Mode A | MP3: ON | 60s`
    
- `霧が抜け、澄んでいく透明感の映像。音楽を主役に、ソルフェジオを薄く重ねます。`
    

---

## Demo 4：852 Intuition × Mode C（“気配の底”を確認）

**狙い：余白・奥行き。Schumannを“気配”として成立させる**

- Hz：852（P852_INTUITION_v1）
    
- Mode：C（Schumann 7.83）
    
- MP3：ON推奨
    
- Mix：
    
    - MP3 70 / Tone 18 / Extra 8 / Master 70
        
    - Ducking 20
        

自動説明文：

- `852Hz / Intuition | Mode C | MP3: ON | 60s`
    
- `余白と奥行き。星屑が上へ昇る神秘の映像。音楽を主役に、7.83Hzの揺れを“気配”として加えます。`
    

---

# 使い方（デモ運用ルール）

- まずこの4本を **同じMP3**で出す（差が比較できる）
    
- どれかで違和感が出たら、触る順番は固定：
    
    1. Theme Strength
        
    2. Tone Volume（曲が遠いなら下げる）
        
    3. Extra Volume（不快なら下げる）
        

---

# アプリ初回起動の導線（おすすめ）

起動時に「Demo Presets」カードを出して：

- [Run Demo 4 Pack]（自動で4本プレビュー生成でもOK）
    
- もしくは [Load Demo Setting] を4つ並べる
    

---

次は、このデモセットを **アプリ内に持たせる“プリセットJSON束（demo_pack.json）”**の形にします。  
（実装者がそのまま埋め込めるデータになります）

はい

`{   "demo_pack_version": "1.0",   "name": "AuraLoop Demo 4 Pack",   "defaults": {     "preview": { "duration_sec": 10, "resolution": [1080, 1920], "fps": 30 },     "export": {       "duration_sec": 60,       "resolution": [1080, 1920],       "fps": 30,       "format": "mp4_h264_aac",       "filename_template": "AuraLoop_{hz}_{mode}_{goal}_{dur}s_{datetime}.mp4"     },     "mp3_placeholder": {       "enabled": true,       "source": { "type": "file_ref", "name": "demo_or_user_mp3.mp3", "hash": null },       "preview_segment": { "policy": "auto_mid", "auto_mid_ratio": 0.3 },       "export_segment": { "policy": "fit_export" },       "looping": { "enabled": true, "crossfade_sec": 1.5 },       "stereo_mode": "preserve"     },     "mixer_safe": {       "gain_mp3": 70,       "gain_tone": 20,       "gain_extra": 8,       "gain_master": 70,       "ducking": { "enabled": true, "target": "tone", "amount": 20, "attack_ms": 40, "release_ms": 220 }     },     "safety": {       "limiter_enabled": true,       "limiter_ceiling_db": -1.0,       "max_extra_gain_cap": 20,       "no_flicker_audio": true     }   },   "projects": [     {       "project_version": "1.0",       "id": "DEMO_396_A_SAFE_60S",       "title": "396Hz Ground | Mode A | Safe",       "auto_description": [         "396Hz / Ground | Mode A | MP3: ON | 60s",         "重心を下へ。沈む静けさで定着させる映像。音楽を主役に、ソルフェジオを薄く重ねます。"       ],       "video": {         "preset_id": "P396_GROUND_v1",         "overrides": { "theme_strength": 50, "advanced": { "depth": 50, "motion": 50, "contrast": 50 } }       },       "audio": {         "audio_spec_version": "1.0",         "mode": "A",         "mp3_bed": { "$ref": "#/defaults/mp3_placeholder" },         "tone_solfeggio": {           "enabled": true,           "hz": 396,           "waveform": "sine",           "harmonics": { "enabled": false, "amount": 0.0 },           "stereo": "dual_mono",           "phase_lock": true         },         "extra": { "enabled": false },         "mixer": {           "gain_mp3": 70,           "gain_tone": 20,           "gain_master": 70,           "ducking": { "enabled": true, "target": "tone", "amount": 20, "attack_ms": 40, "release_ms": 220 }         },         "safety": { "$ref": "#/defaults/safety" },         "ui_notes": {           "headphone_recommended": false,           "disclaimer_short": "音量は無理のない範囲で調整してください。"         }       },       "preview": { "$ref": "#/defaults/preview" },       "export": { "$ref": "#/defaults/export" }     },     {       "project_version": "1.0",       "id": "DEMO_528_B_FOCUS_60S",       "title": "528Hz Repair | Mode B Focus | Safe",       "auto_description": [         "528Hz / Repair | Mode B: Focus | MP3: ON | 60s",         "中心核に集まり、粒子が揃って整う映像。音楽を主役に、目的別バイノーラルを“薄く”追加します。（輪郭が立つ）"       ],       "video": {         "preset_id": "P528_REPAIR_v1",         "overrides": { "theme_strength": 50, "advanced": { "depth": 50, "motion": 50, "contrast": 50 } }       },       "audio": {         "audio_spec_version": "1.0",         "mode": "B",         "mp3_bed": { "$ref": "#/defaults/mp3_placeholder" },         "tone_solfeggio": {           "enabled": true,           "hz": 528,           "waveform": "sine",           "harmonics": { "enabled": false, "amount": 0.0 },           "stereo": "dual_mono",           "phase_lock": true         },         "extra": {           "enabled": true,           "type": "binaural",           "goal": "focus",           "carrier_hz": 200.0,           "beat_hz": 16.0,           "stereo": "binaural_lr"         },         "mixer": { "$ref": "#/defaults/mixer_safe" },         "safety": { "$ref": "#/defaults/safety" },         "ui_notes": {           "headphone_recommended": true,           "disclaimer_short": "バイノーラルはイヤホン推奨。違和感があればExtraを下げてください。"         }       },       "preview": { "$ref": "#/defaults/preview" },       "export": { "$ref": "#/defaults/export" }     },     {       "project_version": "1.0",       "id": "DEMO_741_A_CLEAR_60S",       "title": "741Hz Clear | Mode A | Thin Tone",       "auto_description": [         "741Hz / Clear | Mode A | MP3: ON | 60s",         "霧が抜け、澄んでいく透明感の映像。音楽を主役に、ソルフェジオを薄く重ねます。"       ],       "video": {         "preset_id": "P741_CLEAR_v1",         "overrides": { "theme_strength": 50, "advanced": { "depth": 50, "motion": 50, "contrast": 50 } }       },       "audio": {         "audio_spec_version": "1.0",         "mode": "A",         "mp3_bed": { "$ref": "#/defaults/mp3_placeholder" },         "tone_solfeggio": {           "enabled": true,           "hz": 741,           "waveform": "sine",           "harmonics": { "enabled": false, "amount": 0.0 },           "stereo": "dual_mono",           "phase_lock": true         },         "extra": { "enabled": false },         "mixer": {           "gain_mp3": 70,           "gain_tone": 18,           "gain_master": 70,           "ducking": { "enabled": true, "target": "tone", "amount": 20, "attack_ms": 40, "release_ms": 220 }         },         "safety": { "$ref": "#/defaults/safety" },         "ui_notes": {           "headphone_recommended": false,           "disclaimer_short": "音量は無理のない範囲で調整してください。"         }       },       "preview": { "$ref": "#/defaults/preview" },       "export": { "$ref": "#/defaults/export" }     },     {       "project_version": "1.0",       "id": "DEMO_852_C_SCHUMANN_60S",       "title": "852Hz Intuition | Mode C Schumann | Safe",       "auto_description": [         "852Hz / Intuition | Mode C | MP3: ON | 60s",         "余白と奥行き。星屑が上へ昇る神秘の映像。音楽を主役に、7.83Hzの揺れを“気配”として加えます。"       ],       "video": {         "preset_id": "P852_INTUITION_v1",         "overrides": { "theme_strength": 50, "advanced": { "depth": 50, "motion": 50, "contrast": 50 } }       },       "audio": {         "audio_spec_version": "1.0",         "mode": "C",         "mp3_bed": { "$ref": "#/defaults/mp3_placeholder" },         "tone_solfeggio": {           "enabled": true,           "hz": 852,           "waveform": "sine",           "harmonics": { "enabled": false, "amount": 0.0 },           "stereo": "dual_mono",           "phase_lock": true         },         "extra": {           "enabled": true,           "type": "schumann_binaural",           "carrier_hz": 200.0,           "beat_hz": 7.83,           "stereo": "binaural_lr"         },         "mixer": {           "gain_mp3": 70,           "gain_tone": 18,           "gain_extra": 8,           "gain_master": 70,           "ducking": { "enabled": true, "target": "tone", "amount": 20, "attack_ms": 40, "release_ms": 220 }         },         "safety": { "$ref": "#/defaults/safety" },         "ui_notes": {           "headphone_recommended": true,           "disclaimer_short": "イヤホン推奨。違和感があればExtraを下げてください。"         }       },       "preview": { "$ref": "#/defaults/preview" },       "export": { "$ref": "#/defaults/export" }     }   ],   "notes": [     "defaults.mp3_placeholder.source は実装側で差し替え（ユーザーのMP3参照に置換）",     "Mode A では mixer.gain_extra は無視してOK",     "Export時は MP4 と同名のサイドカーJSON（project全体）を必ず保存"   ] }`

※この `demo_pack.json` をアプリに同梱して、起動時に「Demo Presets」として `projects[]` を一覧表示 → “Load”でUIへ流し込むだけでOKです。

はい

思考時間: 1m 20s

読み込みました（Grok側の案は「**無料ホスティング＋ローカル処理（Web Audio / Canvas(or Three.js) / ffmpeg.wasm / MediaRecorder）**で完結できる」「映像は粒子＋シェーダで作り、音に反応させられる」「MP4はWebM録画→ffmpeg変換がラク」という方向性でした）。いま作っている仕様とも矛盾ありません。

で、さっきの `demo_pack.json` は **`$ref`が“素のJSONとしては非対応”**になりがちなので、アプリに同梱しやすい形で **2種類**用意しました。

- **展開済み（そのままJSONとして読める）**  
    demo_pack_expanded.json
    
- **軽量版（defaults + $inherit を自前マージする前提）**  
    demo_pack_merge.json
    
- 説明  
    demo_pack_README.txt
    

## どっちを使うべき？

- **MVPで最短**：`demo_pack_expanded.json`（ローダーが超簡単）
    
- **今後プリセットが増える**：`demo_pack_merge.json`（差分だけ持てて管理が楽）
    

## merge版を使う場合の“マージ規約”（これだけ）

- `{"$inherit":"defaults.xxx"}` を見つけたら、そのdefaultsを **ディープコピー**して置換
    
- もし `$inherit` と他キーが同居してたら、defaultsに上書きマージ（将来拡張用）
    

次はこのデモパックを前提に、**アプリ起動時の「Demo Presets一覧UI」＋「LoadでUIへ流し込み」＋「Run Demo 4 Pack（連続プレビュー生成）」**の最小仕様を出します（コードに落としやすいイベント設計まで）。

はい

了解。では **起動時の Demo Presets 一覧UI** と、**Load→UI反映**、**Run Demo 4 Pack（連続プレビュー生成）** の“最小仕様（イベント設計まで）”を出します。  
※実装方式（React/Electron/素Web）は問わず、そのままチケット化できる粒度にします。

---

# 1) Demo Presets 一覧UI（最小仕様）

## 表示場所

- 左パネル上部に「Demo Presets」セクションを追加（または初回だけモーダル）
    

## 表示データソース

- `demo_pack_expanded.json` の `projects[]`
    

## 1行（カード）に出す情報

- `title`
    
- `auto_description[0]`（条件1行）
    
- 小さく：`preset_id` / `audio.mode` / `hz`
    
- ボタン：`Load` / `Preview 10s`
    

## 追加ボタン（セクションの先頭）

- `Run Demo 4 Pack`（連続プレビュー生成）
    
- `Set MP3 for Demo...`（任意：デモ全体に使うMP3を指定）
    

---

# 2) Load の挙動（UIへ流し込み）

## イベント

- `DEMO_LOAD_PROJECT(projectId)`
    

## 処理（必須）

1. demo_packから対象projectを取得
    
2. 現在の `ProjectState` をそのprojectで置換（深いコピー）
    
3. UI各コントロールに反映（双方向バインド）
    
4. Exportボタンは **PASSが出るまで disabled** に戻す
    
5. 右の Review Sheet をテーマに合わせて差し替え（396/528/741/852）
    

## 注意（MP3参照）

- demoは `mp3_bed.source.name="demo_or_user_mp3.mp3"` なので
    
    - 既にユーザーがMP3を読み込んでいるなら、その参照で上書きしてOK（推奨）
        
    - 読み込んでいないなら `mp3_bed.enabled=true` のままでも良いが、再生できないのでUIに
        
        - `MP3 missing (optional)` を表示
            

---

# 3) Preview 10s（単発）の挙動

## イベント

- `DEMO_PREVIEW(projectId)`（内部で Load→Preview を連続実行でもOK）
    

## 処理

1. `DEMO_LOAD_PROJECT(projectId)` 実行
    
2. `GENERATE_PREVIEW()` 実行
    
3. 完了したら右のReviewを初期状態（未チェック）で表示
    
4. 可能なら自動で「自動説明文」をプレビュー下に出す
    

---

# 4) Run Demo 4 Pack（連続プレビュー生成）

## ゴール

- ユーザーが“質の差”を短時間で比較できるように
    
- **同じMP3**で 4つの10秒プレビューを自動生成して並べる（理想）
    
- MVPなら「順番に生成して最後のものを表示」でも可
    

## UI案（最小）

- クリックするとステータスが出る：
    
    - `Running demo 1/4...`
        
- 完了後に小さなギャラリー：
    
    - `396 / 528 / 741 / 852` のサムネ（静止画でもOK）＋再生ボタン
        
    - または「Last result」だけでもOK（MVP）
        

## イベント

- `DEMO_RUN_ALL_PREVIEWS()`
    

## 処理フロー（逐次でOK）

1. demo順序を固定：`[396A, 528B, 741A, 852C]`
    
2. 各projectについて：
    
    - Load
        
    - Preview生成（10s）
        
    - 生成結果を `demo_results[]` に保存
        
3. 全部終わったらギャラリー表示
    

### demo_results の保持（MVP）

`demo_results = [   { id, title, videoUrl, audioMode, hz, createdAt } ]`

---

# 5) Preview生成の“共通インターフェース”（重要）

UI側は実装を知らずに呼べるように、1つの関数契約を作ります。

## Interface

- `generatePreview(projectJson) -> { videoUrl, meta }`
    

## meta（最低限）

- `duration_sec: 10`
    
- `resolution: [1080,1920]`
    
- `fps: 30`
    
- `audio: { mode, hz, goal, mix }`
    
- `video: { preset_id, theme_strength }`
    

---

# 6) 状態管理（最低限）

## state

- `currentProject`（UIが編集しているProject JSON）
    
- `previewState`：`idle | generating | ready | error`
    
- `previewOutput`：`{ url, meta }`
    
- `demoRunState`：`idle | running | done | error`
    
- `demoResults[]`
    

---

# 7) 失敗時のUX（沼回避）

- Preview生成が失敗したら右上に1行：
    
    - `Preview failed. Try again.` + [Retry]
        
- Demo一括中に失敗したら：
    
    - `Demo failed at 2/4 (528 Focus).`
        
    - [Retry from failed]（できたら） / [Stop]
        

---

# 8) チケット化できる最小タスク

1. demo_pack_expanded.json を読み込み（同梱 or fetch）
    
2. Demo Presets一覧カード表示（projects[]）
    
3. LoadでUIへ流し込み（ProjectState置換）
    
4. Preview 10s（単発）ボタン
    
5. Run Demo 4 Pack（逐次プレビュー）＋進捗表示
    

---

次は、これをさらに実装しやすくするために、**「Demo Pack ローダー仕様（ファイル配置・読み込み・型）」**と、**「UIへ反映する setProject() の擬似コード」**を出します。

はい

了解。では **Demo Pack ローダー仕様（配置・読み込み・型）** と、**UIへ反映する setProject() 擬似コード** をまとめます。  
（ElectronでもWebでも同じ発想でいけるように）

---

# 1) Demo Pack ローダー仕様 v1

## 1-1. ファイル配置（おすすめ）

### Electron/ローカルアプリ

- `assets/demo_pack_expanded.json`（ビルドに同梱）
    
- 読み込みは `fs.readFile` でも `fetch` でもOK
    

### Web/静的ホスティング

- `/demo/demo_pack_expanded.json`（public配下）
    
- 読み込みは `fetch('/demo/demo_pack_expanded.json')`
    

---

## 1-2. 読み込み手順

### API（UIから呼ぶ関数）

- `loadDemoPack(): Promise<DemoPack>`
    

### 処理

1. JSONを読み込む
    
2. `demo_pack_version` をチェック（`"1.0"`以外なら警告）
    
3. `projects[]` の必須フィールドを軽く検証
    
4. そのまま state に保持
    

---

## 1-3. 型定義（TypeScript風）

`type DemoPack = {   demo_pack_version: string;   name: string;   defaults?: any;          // expanded版は必須ではない   projects: Project[];   notes?: string[]; };  type Project = {   project_version: string;   id: string;   title: string;   auto_description?: [string, string];   video: {     preset_id: string;     overrides?: {       theme_strength?: number;       advanced?: { depth?: number; motion?: number; contrast?: number; };     };   };   audio: AudioSpec;   preview: { duration_sec: number; resolution: [number, number]; fps: number; };   export: { duration_sec: number; resolution: [number, number]; fps: number; format: string; filename_template: string; }; };  type AudioSpec = {   audio_spec_version: string;   mode: "A" | "B" | "C";   mp3_bed: any;   tone_solfeggio: any;   extra: any;   mixer: any;   safety?: any;   ui_notes?: any; };`

---

## 1-4. 最低限の検証（壊れたJSON対策）

読み込み後に、これだけ見れば十分です。

- `projects` が配列で1件以上
    
- 各projectに `id`, `video.preset_id`, `audio.mode` がある
    
- `preview.duration_sec === 10`（デモ用途）
    
- `export.duration_sec` がある（デモは60）
    

---

# 2) setProject()（UIへ反映）の擬似コード

## 2-1. 目的

- デモ/復元/新規、どの入口でも **同じ関数**でUIを確実に更新する
    
- 「反映漏れ」を消す
    

## 2-2. 擬似コード

`function deepClone(obj) {   return JSON.parse(JSON.stringify(obj)); }  function setProject(nextProject, options = {}) {   // options:   //  - keepCurrentMp3Ref: boolean (default true)   //  - resetReviewState: boolean (default true)   //  - forceDisableExport: boolean (default true)    const cur = state.currentProject;    // 1) deep copy（参照事故防止）   let p = deepClone(nextProject);    // 2) MP3参照の扱い（デモはplaceholderなので、ユーザーのMP3があれば置換推奨）   const keep = options.keepCurrentMp3Ref ?? true;    if (keep && cur?.audio?.mp3_bed?.enabled && cur.audio.mp3_bed.source) {     // 「ユーザーが今読み込んでるMP3」を優先して引き継ぐ     p.audio.mp3_bed.enabled = true;     p.audio.mp3_bed.source = deepClone(cur.audio.mp3_bed.source);   } else {     // 逆に、MP3を強制OFFにする運用もあり     // p.audio.mp3_bed.enabled = false;   }    // 3) Modeによる整合（Extra表示・値の無視）   if (p.audio.mode === "A") {     p.audio.extra = { enabled: false };     // gain_extraがあっても無視でOKだが、UIが混乱するなら消す     if (p.audio.mixer) delete p.audio.mixer.gain_extra;   } else {     // B/Cは enabled=true 前提（ただし安全に）     if (!p.audio.extra) p.audio.extra = { enabled: true };     p.audio.extra.enabled = true;   }    // 4) UI state更新（これが唯一の入口）   state.currentProject = p;    // 5) UIの派生状態を更新（見た目・説明文・警告）   state.ui.autoDescriptionLine1 = buildAutoLine1(p);   state.ui.autoDescriptionLine2 = buildAutoLine2(p);    // MP3 missing 警告（sourceがplaceholder/見つからない等）   state.ui.mp3Warning = detectMp3Missing(p);    // 6) Review状態をリセット   if (options.resetReviewState ?? true) {     state.review = initReviewStateForTheme(p.audio.tone_solfeggio.hz);     state.review.result = "UNREVIEWED";   }    // 7) Exportボタン制御   if (options.forceDisableExport ?? true) {     state.ui.exportEnabled = false; // PASSが出るまで無効   }    // 8) 画面のコントロールへ反映（Reactならstate更新で自動）   render(); }`

---

# 3) buildAutoLine1/2（自動説明文生成）の擬似コード

``function themeNameByHz(hz) {   return {     396:"Ground",417:"Reset",528:"Repair",639:"Harmony",741:"Clear",852:"Intuition"   }[hz] ?? "Theme"; }  function buildAutoLine1(p) {   const hz = p.audio.tone_solfeggio?.hz;   const theme = themeNameByHz(hz);   const mode = p.audio.mode;   const goal = (mode === "B") ? (p.audio.extra?.goal ?? "") : "";   const mp3 = p.audio.mp3_bed?.enabled ? "ON" : "OFF";   const dur = p.export?.duration_sec ?? 60;   return `${hz}Hz / ${theme} | Mode ${mode}${goal?`: ${goal}`:""} | MP3: ${mp3} | ${dur}s`; }  function buildAutoLine2(p) {   const hz = p.audio.tone_solfeggio?.hz;   const mode = p.audio.mode;   const themeLine = themePhraseByHz(hz);     // 先に定義した固定文   const audioLine = audioPhraseByMode(mode, p.audio.mp3_bed?.enabled);   const goalTag = (mode === "B") ? goalTagByGoal(p.audio.extra?.goal) : "";   return `${themeLine}${audioLine}${goalTag ? ` ${goalTag}` : ""}`; }``

---

# 4) detectMp3Missing（MP3未指定の警告）

実装依存ですが、最小はこれでOK：

`function detectMp3Missing(p) {   if (!p.audio.mp3_bed?.enabled) return null;   const src = p.audio.mp3_bed.source;   if (!src) return "MP3 missing. Please import or re-link.";   if (src.name === "demo_or_user_mp3.mp3") return "MP3 not set (optional). Import your MP3 for best demo.";   // Electronなら path exists をチェックしても良い   return null; }`

---

# 5) Run Demo 4 Pack（逐次生成）の擬似コード

``async function runDemo4Pack(demoPack) {   state.demoRunState = "RUNNING";   state.demoResults = [];    const order = ["DEMO_396_A_SAFE_60S","DEMO_528_B_FOCUS_60S","DEMO_741_A_CLEAR_60S","DEMO_852_C_SCHUMANN_60S"];    for (let i=0; i<order.length; i++) {     const proj = demoPack.projects.find(x => x.id === order[i]);     if (!proj) continue;      setProject(proj, { keepCurrentMp3Ref: true, resetReviewState: true, forceDisableExport: true });     state.ui.status = `Running demo ${i+1}/${order.length}...`;      const out = await generatePreview(state.currentProject); // 10s     state.demoResults.push({       id: proj.id,       title: proj.title,       hz: state.currentProject.audio.tone_solfeggio.hz,       mode: state.currentProject.audio.mode,       url: out.videoUrl,       meta: out.meta,       createdAt: Date.now()     });   }    state.demoRunState = "DONE";   state.ui.status = "Demo done.";   render(); }``

---

# 最小実装の結論（これだけで回る）

- `loadDemoPack()`
    
- `setProject()`
    
- `generatePreview()`
    
- `runDemo4Pack()`
    

これで **デモ→ロード→プレビュー→比較**が一気に繋がります。

---

次は、あなたが以前のアプリで躓いた「**生成してみたら思った画じゃない**」を防ぐために、  
**プレビュー出力から自動で“合否の推奨”を出す簡易ルール（例：明滅検出、粒子密度、彩度上限）**を設計します。

はい

思考時間: 14s

了解。じゃあ **10秒プレビューから自動で「PASS/FAIL＋次に触る1手」**を出すための、**軽量な自動判定ルール（映像＋音）**を設計します。  
（重い光学フロー/OCRみたいなのは避けて、Canvasのフレーム統計＋音のレベル統計でいきます）

---

# Auto Review v1（出力フォーマット）

プレビュー生成後にこれを返す（UI右欄のReviewに流し込める形）：

`{   "result": "PASS|WARN|FAIL",   "checks": [     { "id": "flicker", "status": "ok|warn|fail", "score": 0.12, "hint": "Theme Strength ↓" }   ],   "suggestions": [     "Theme Strength を 10 下げて再プレビュー",     "Tone Volume を 5 下げる"   ] }`

---

# 映像：自動判定（軽量で効くやつ）

前提：10秒/30fps=300フレーム全部は重いので、**等間隔サンプル**で十分。

- 推奨：`N=60`（0.166秒ごと）
    
- さらに軽く：`N=30`
    

## 1) ループ継ぎ目（最重要）

**狙い**：最初と最後のフレームが離れてたら、ループが“切れる”。

- 指標：`loop_seam = meanAbsDiff(frame0, frameLast)`（0..1）
    
- 閾値：
    
    - `<= 0.02` OK
        
    - `0.02〜0.05` WARN
        
    - `> 0.05` FAIL（ループ切れ）
        

**FAIL時の1手**：`Motion ↓`（または flow_strength を内部で少し下げる）

---

## 2) 点滅（フリッカー）検出（禁止事項）

**狙い**：明滅が強いと即NG。  
フリッカーは「平均輝度の時間変化」でかなり拾えます。

- 各フレームで平均輝度 `L[t]` を計算（0..1）
    
- 指標1：`dL = abs(L[t]-L[t-1])` の **95パーセンタイル**
    
- 指標2：`max(dL)`（瞬間的な跳ね）
    

閾値（目安）：

- 95p `<= 0.015` OK
    
- 95p `0.015〜0.03` WARN
    
- 95p `> 0.03` FAIL
    

**FAIL時の1手**：`Contrast ↓` → まだダメなら `Theme Strength ↓`

> ※粒子のランダム点滅が原因なら、内部で「粒子αの時間変化」を抑える（UIは触らせない）

---

## 3) “ネオン化”検出（上品さの担保）

**狙い**：彩度が高すぎるとテックっぽくなる。

- HSVに変換して、`S > 0.75` のピクセル比率 `sat_hot_ratio`
    
- 閾値：
    
    - `<= 3%` OK
        
    - `3%〜8%` WARN
        
    - `> 8%` FAIL
        

**FAIL時の1手**：`Contrast ↓`（次点：Theme Strength ↓）

---

## 4) 視認疲労（動きが速すぎる）

光学フローなしで「動き量」を推定：

- 指標：連続フレーム差分の平均  
    `motion = mean(meanAbsDiff(frame[t], frame[t-1]))`
    
- 閾値：
    
    - `<= 0.025` OK
        
    - `0.025〜0.045` WARN
        
    - `> 0.045` FAIL
        

**FAIL時の1手**：`Motion ↓`

---

## 5) モアレ/ザラつき（簡易）

“細かい模様の密度”を見ます（Sobel/Laplacianの平均でOK）。

- 指標：`edge_density`（0..1）＝エッジ強度が閾値超えたピクセル比率
    
- 閾値（目安）：
    
    - `<= 6%` OK
        
    - `6%〜12%` WARN
        
    - `> 12%` FAIL
        

**FAIL時の1手**：`Theme Strength ↓`（粒子が多すぎる場合が多い）

---

# 音：自動判定（最初は“事故防止”だけで十分）

ここは **ミックス前に各トラックのレベルが分かる**構造にしておくと、判定が超簡単で強いです。  
（MP3/Tone/Extraを別バスで持ってる前提）

## 1) クリップ/割れ検出（必須）

- 指標：`truePeakDb`（またはサンプルピークでも可）
    
- 閾値：
    
    - `<= -1.0 dB` OK
        
    - `-1.0〜0 dB` WARN
        
    - `> 0 dB` FAIL
        

**FAIL時の1手**：`Master ↓`（内部Limiterがあるなら WARN に落とせる）

---

## 2) MP3が主役か（“曲が消える事故”）

ミックス後の相対バランスを、**バスRMS**で判定（dB差で見る）。

- `rms_mp3_db`, `rms_tone_db`, `rms_extra_db`
    
- 目標（推奨）：
    
    - Tone：MP3より **-12〜-24 dB**
        
    - Extra：MP3より **-18〜-30 dB**（薄く）
        

判定：

- Tone が `>-9 dB差`（近すぎ） → WARN（Toneが出過ぎ）
    
- Tone が `>-6 dB差` → FAIL（曲を邪魔）
    
- Extra が `>-12 dB差` → WARN
    
- Extra が `>-9 dB差` → FAIL（不快リスク）
    

**FAIL時の1手**

- Tone問題 → `Tone Volume ↓`
    
- Extra問題 → `Extra Volume ↓`
    

---

## 3) バイノーラルが“成立してるか”（B/Cのみ）

ステレオ相関で簡易チェック：

- 指標：`corr = corrcoef(L, R)`（-1..1）
    
- 目安：
    
    - Mode A（dual_mono）→ `corr >= 0.95` でOK
        
    - Mode B/C（binaural）→ `corr` が **0.2〜0.9**くらいに落ちるのが自然  
        `corr >= 0.95` なら「実質モノ」疑い（Extraが効いてない or 合成が壊れてる）
        

**FAIL時の1手**：実装バグ疑い（stereo path確認）  
（ユーザー操作で救えないので “Developer alert”）

---

# 判定ロジック（PASS/WARN/FAIL）

- FAILが1つでも出たら `FAIL`
    
- FAILなしでWARNが1つでも出たら `WARN`
    
- 全部OKなら `PASS`
    

UI上は、Exportは `PASS` のときのみ有効（仕様どおり）。

---

# “次に触る1手”生成（沼防止）

FAIL/WARNの種類で、提案は必ず1〜2個に絞る：

- flicker/contrast/sat_hot → **Contrast ↓（10）**
    
- motion → **Motion ↓（10）**
    
- edge_density → **Theme Strength ↓（10）**
    
- mp3_not_main → **Tone ↓（5）**
    
- extra_too_loud → **Extra ↓（5）**
    
- clip → **Master ↓（10）**
    

---

# 実装メモ（超ざっくり擬似コード）

`frames = sampleFrames(previewVideoOrCanvas, N=60)  loopSeam = meanAbsDiff(frames[0], frames[N-1])  L = frames.map(f => meanLuma(f)) dL = absDiffSeries(L) flicker95 = percentile(dL, 95)  satHotRatio = mean(frames.map(f => ratioHSV_S_gt(f, 0.75))) motion = mean(frames.slice(1).map((f,i)=>meanAbsDiff(f, frames[i])))  edgeDensity = mean(frames.map(f => sobelEdgeRatio(f, edgeThresh)))  audio = analyzeBuses(mp3Bus, toneBus, extraBus, mixedBus)`

---

次は、この Auto Review を **Demo 4本それぞれに“期待値（基準）”として持たせる**設計にします。  
例：741は `flicker95` を特に厳しく、396は `edge_density` を特に厳しく、みたいに“テーマ別に最適化”します。

はい

了解。じゃあ **テーマ（Hz）別に Auto Review の基準を最適化**します。  
同じ閾値だと「396（重い）」と「852（余白）」で誤判定が出るので、**“重視項目”と“閾値の微調整”**をテーマごとに持たせます。

---

# Theme-Aware Auto Review v1

## 1) 仕組み（設計）

- 基本閾値（global）を持つ
    
- 各テーマ（396/417/528/639/741/852）が
    
    - **重視するチェック**（weight）
        
    - **閾値の微調整**（override）  
        を持つ
        
- 最終判定は **重み付きスコア + FAIL即死ルール**のハイブリッド
    

---

# 2) 基本閾値（global）

（前回のものをベースに固定）

`{   "global": {     "loop_seam": { "ok": 0.02, "warn": 0.05 },     "flicker95": { "ok": 0.015, "warn": 0.03 },     "sat_hot_ratio": { "ok": 0.03, "warn": 0.08 },     "motion": { "ok": 0.025, "warn": 0.045 },     "edge_density": { "ok": 0.06, "warn": 0.12 },      "true_peak_db": { "ok": -1.0, "warn": 0.0 },     "tone_vs_mp3_db": { "warn": -9, "fail": -6 },     "extra_vs_mp3_db": { "warn": -12, "fail": -9 },      "corr_mono_ok": 0.95,     "corr_binaural_max": 0.95   } }`

---

# 3) テーマ別プロファイル（weight + override）

## weightの意味

- 0 = そのチェックは参考程度
    
- 1 = 通常
    
- 2 = 強く重視
    
- 3 = 最重要（ここが悪いと体感が壊れる）
    

---

## 396 Ground（沈む・安定）

**狙い**：動きは少なく、ザラつき（エッジ密度）を抑え、点滅は厳禁。

- 重視：`flicker`, `motion`, `edge_density`, `loop_seam`
    
- 許容：彩度は低め（satも厳しめ）
    

**override（少し厳しく）**

- flicker95 warnを 0.028（少し厳しく）
    
- motion warnを 0.040（少し厳しく）
    
- edge_density warnを 0.10（少し厳しく）
    

`"396": {   "weights": { "loop_seam":3, "flicker95":3, "motion":3, "edge_density":2, "sat_hot_ratio":2 },   "override": {     "flicker95": { "ok": 0.014, "warn": 0.028 },     "motion": { "ok": 0.022, "warn": 0.040 },     "edge_density": { "ok": 0.055, "warn": 0.10 },     "sat_hot_ratio": { "ok": 0.025, "warn": 0.06 }   } }`

---

## 417 Reset（ほどく・切り替える）

**狙い**：変化点はあっていいが、点滅ではなく“流れ”。ループは厳しく。

- 重視：`loop_seam`, `flicker`
    
- motionは少し許容（変化の演出がある）
    

`"417": {   "weights": { "loop_seam":3, "flicker95":3, "motion":2, "edge_density":1, "sat_hot_ratio":2 },   "override": {     "motion": { "ok": 0.028, "warn": 0.050 }   } }`

---

## 528 Repair（整う・集まる）

**狙い**：中心核の“整列感”が出ると edge が少し増えるので、edgeは少し許容。  
ただしネオン化はNG。ループは重要。

- 重視：`loop_seam`, `sat_hot_ratio`, `flicker`
    
- edge_densityは緩め
    

`"528": {   "weights": { "loop_seam":3, "sat_hot_ratio":3, "flicker95":2, "motion":2, "edge_density":1 },   "override": {     "edge_density": { "ok": 0.07, "warn": 0.14 }   } }`

---

## 639 Harmony（溶け合う・丸くなる）

**狙い**：動きは柔らかく、コントラストやエッジが立ちすぎると台無し。

- 重視：`edge_density`, `motion`, `sat_hot_ratio`
    
- flickerはもちろんNG
    

`"639": {   "weights": { "edge_density":3, "motion":3, "sat_hot_ratio":2, "flicker95":2, "loop_seam":2 },   "override": {     "edge_density": { "ok": 0.055, "warn": 0.10 },     "motion": { "ok": 0.022, "warn": 0.040 }   } }`

---

## 741 Clear（澄む・霧が抜ける）

**狙い**：ここは“上品さの査定用”。点滅とネオンは特に厳しい。  
motionは普通でOK、ループは重要。

- 重視：`flicker`, `sat_hot_ratio`, `loop_seam`
    
- edge_densityも厳しめ（霧が抜けてるのにザラいのはNG）
    

`"741": {   "weights": { "flicker95":3, "sat_hot_ratio":3, "loop_seam":3, "edge_density":2, "motion":1 },   "override": {     "flicker95": { "ok": 0.013, "warn": 0.025 },     "sat_hot_ratio": { "ok": 0.02, "warn": 0.05 },     "edge_density": { "ok": 0.055, "warn": 0.10 }   } }`

---

## 852 Intuition（余白・奥行き）

**狙い**：細部や動きが多いと余白が死ぬ。動きは最も厳しく。  
彩度も厳しめ。ループは重要。

- 重視：`motion`, `edge_density`, `loop_seam`
    
- flickerも厳禁
    

`"852": {   "weights": { "motion":3, "edge_density":3, "loop_seam":3, "flicker95":2, "sat_hot_ratio":2 },   "override": {     "motion": { "ok": 0.020, "warn": 0.035 },     "edge_density": { "ok": 0.050, "warn": 0.095 },     "sat_hot_ratio": { "ok": 0.02, "warn": 0.06 }   } }`

---

# 4) スコア計算（重み付き + FAIL即死）

## FAIL即死（どのテーマでも）

- `loop_seam > warn` → FAIL（切れ目は商品にならない）
    
- `flicker95 > warn` → FAIL（点滅は致命）
    
- `true_peak_db > 0` → FAIL（クリップは致命）
    

## それ以外は重み付き

各指標ごとに

- OK = 0点
    
- WARN = 1点
    
- FAIL = 2点（※即死以外のfail）  
    を付けて、`weight` を掛けて合計。
    
- 合計 `<= 3` → PASS
    
- `4〜7` → WARN
    
- `>= 8` → FAIL
    

（この境界は運用で微調整）

---

# 5) “次に触る1手”もテーマ別に変える

同じFAILでも、テーマで触る順が変わるのがポイント。

- **396/852**：まず `Motion ↓`（余白・安定優先）
    
- **741**：まず `Contrast ↓`（上品さ優先）
    
- **528**：まず `Contrast ↓`、次に `Theme Strength ↓`（整列が強すぎるとネオン化）
    
- **639**：まず `Theme Strength ↓`（溶け合いが壊れる）
    
- **417**：まず `Motion ↓` か `Theme Strength ↓`（流れを整える）
    

---

# 6) JSONとして持たせる形（そのまま同梱できる）

`{   "auto_review_profile_version": "1.0",   "global": { "...": true },   "themes": {     "396": { "weights": { "...": 3 }, "override": { "...": true } },     "417": { "weights": { "...": 3 }, "override": { "...": true } },     "528": { "weights": { "...": 3 }, "override": { "...": true } },     "639": { "weights": { "...": 3 }, "override": { "...": true } },     "741": { "weights": { "...": 3 }, "override": { "...": true } },     "852": { "weights": { "...": 3 }, "override": { "...": true } }   } }`

---

次は、このプロファイルを前提に、**Auto Reviewが返す「suggestions（次の1手）」を自動生成するルール表**を作って完成です。

はい

了解。じゃあ最後に、**Auto Review → suggestions（次の1手）**を自動生成するための「ルール表」を作ります。  
ポイントは **“提案は最大2つ”**、そして **“テーマごとに優先順位が違う”** です。

---

# Suggestions生成ルール v1（最大2つ）

## 0) 入力

- themeHz（396/417/528/639/741/852）
    
- checks[]（各指標の status と score）
    
    - 例：`flicker95: warn`, `motion: fail`, …
        

## 1) 出力

- suggestions: string[]（最大2）
    
- “この順で触れ”を固定する（沼止め）
    

---

# 2) ルール表（指標→操作）

各チェックが `warn/fail` のときに候補を生成。

|check id|条件|提案（操作）|量|
|---|---|---|---|
|loop_seam|warn/fail|`Motion を 10 下げて再プレビュー`|-10|
|flicker95|warn/fail|`Contrast を 10 下げて再プレビュー`|-10|
|sat_hot_ratio|warn/fail|`Contrast を 10 下げる（ネオン抑制）`|-10|
|motion|warn/fail|`Motion を 10 下げて再プレビュー`|-10|
|edge_density|warn/fail|`Theme Strength を 10 下げて再プレビュー`|-10|
|true_peak_db|warn/fail|`Master を 10 下げる（割れ防止）`|-10|
|tone_too_loud|warn/fail|`Tone Volume を 5 下げる（曲を主役に）`|-5|
|extra_too_loud|warn/fail|`Extra Volume を 5 下げる（不快回避）`|-5|
|corr_stereo_bad|fail|`Stereo path を点検（実装バグ疑い）`|dev|

---

# 3) テーマ別 優先順位（ここが肝）

各テーマごとに「提案候補の並べ替え」をします。  
（同じwarnでも“まず何を触るべきか”が違う）

## 396 Ground（安定最優先）

1. flicker95 → Contrast↓
    
2. motion/loop_seam → Motion↓
    
3. edge_density → Theme Strength↓
    

## 417 Reset（ループと流れ）

1. loop_seam → Motion↓
    
2. flicker95 → Contrast↓
    
3. motion → Motion↓
    
4. sat_hot → Contrast↓
    

## 528 Repair（ネオン抑制＋整列維持）

1. sat_hot_ratio → Contrast↓
    
2. flicker95 → Contrast↓
    
3. loop_seam/motion → Motion↓
    
4. edge_density → Theme Strength↓（最後）
    

## 639 Harmony（角が立つのが最大NG）

1. edge_density → Theme Strength↓
    
2. motion → Motion↓
    
3. flicker95/sat_hot → Contrast↓
    

## 741 Clear（上品さ査定）

1. flicker95 → Contrast↓
    
2. sat_hot_ratio → Contrast↓
    
3. edge_density → Theme Strength↓
    
4. loop_seam → Motion↓（最後）
    

## 852 Intuition（余白＝動きと密度を最優先で抑える）

1. motion → Motion↓
    
2. edge_density → Theme Strength↓
    
3. loop_seam → Motion↓
    
4. flicker95/sat_hot → Contrast↓
    

---

# 4) “最大2つ”に絞るアルゴリズム

## 4-1 まず「即死系」を優先

- loop_seam FAIL / flicker FAIL / true_peak FAIL があれば、そこから1つ選ぶ（テーマ優先順で）
    

## 4-2 次に「体感を壊す系」を1つ

- motion / sat_hot / edge_density のうち、最優先のものを1つ
    

## 4-3 音は“事故防止”が最優先

- true_peak → Master↓（最優先）
    
- 次に extra_too_loud → Extra↓
    
- 次に tone_too_loud → Tone↓
    

※映像と音の両方が悪いなら、

- 1枠目：映像（テーマ優先）
    
- 2枠目：音（true_peak or extra or tone）  
    にするのが最も沼らないです。
    

---

# 5) 実装しやすい擬似コード

`function buildSuggestions(themeHz, checks) {   const bad = checks.filter(c => c.status !== "ok");    // 1) dev fail   if (bad.some(c => c.id === "corr_stereo_bad" && c.status === "fail")) {     return ["Stereo path を点検（実装バグ疑い）"];   }    // 2) map check -> suggestion   const candidates = bad.map(c => ({     id: c.id,     severity: c.status === "fail" ? 2 : 1,     text: suggestionText(c.id),   }));    // 3) theme priority order   const order = themePriority(themeHz); // ["flicker95","motion","edge_density",...]   const rank = id => order.indexOf(id) >= 0 ? order.indexOf(id) : 999;    // 4) split video/audio   const audioIds = new Set(["true_peak_db","tone_too_loud","extra_too_loud"]);   const vids = candidates.filter(x => !audioIds.has(x.id)).sort((a,b)=> (rank(a.id)-rank(b.id)) || (b.severity-a.severity));   const auds = candidates.filter(x => audioIds.has(x.id)).sort((a,b)=> (b.severity-a.severity));    const out = [];    // pick 1 from video if exists   if (vids.length) out.push(vids[0].text);    // pick 1 from audio if exists else pick next video   if (auds.length) out.push(auds[0].text);   else if (vids.length > 1) out.push(vids[1].text);    return out.slice(0,2); }`

---

# 6) UI表示（1行で刺す）

右欄の最下部にこう出します：

- `Recommended: Contrast ↓10`
    
- `Then: Extra ↓5`
    

（詳細説明は不要。沼らないために“短い命令形”が最強）

---

これで「テーマ別Auto Review」「最大2手の改善指示」まで揃いました。  
次は、ここまでの仕様を **1枚の“実装用まとめ（Spec v1）”**として整理（見出し＋JSONスキーマ＋チェック表）して、開発にそのまま渡せる形にします。

はい

了解。ここまでの内容を **「AuraLoop Studio Spec v1（実装用まとめ）」**として1枚に整理します。  
（このままチケット化・実装に渡せる形）

---

# AuraLoop Studio Spec v1（実装用まとめ）

## 目的

ユーザーMP3に **ソルフェジオ（必須）＋（任意で）バイノーラル / シューマン**を薄くミックスし、**9:16ループ映像**と同期させて **10秒プレビュー→合否→Export**する。

---

## 1) モード仕様（固定）

- **A**：ソルフェジオのみ
    
- **B**：ソルフェジオ + バイノーラル（目的5種）
    
- **C**：ソルフェジオ + シューマン共振（7.83Hzをバイノーラルで可聴化）
    
- 映像テーマは **常にソルフェジオのHzが優先**（video presetを決める）
    

---

## 2) UI（1画面完結）

### 左：Controls

1. Solfeggio（396/417/528/639/741/852）※映像テーマも同時決定
    
2. Audio Mode（A/B/C）
    
    - Bのみ：Goal（Sleep/Medit/Relax/Focus/Peak）
        
3. MP3 Bed：Upload/Remove、Preview segment（Auto mid 30% / Pick）
    
4. Visual：Theme Strength（基本） + Advanced（Depth/Motion/Contrast）
    
5. Mixer：MP3/Tone/Extra/Master + Ducking（Tone）
    
6. Export：15/30/60/180、Policy（Fit export / Match MP3）
    
7. Reset/Undo
    

### 中央：Preview

- 9:16 Live preview
    
- [Generate Preview 10s]
    
- [Export Full]（**PASS時のみ有効**）
    

### 右：Review

- 手動チェック（項目）＋ Auto Review結果（PASS/WARN/FAIL）
    
- FAIL時は **“次の1手（最大2つ）”**だけ表示
    

---

## 3) Project JSON（保存/復元の唯一の真実）

### 最小構造

`{   "project_version": "1.0",   "video": { "preset_id": "P528_REPAIR_v1", "overrides": { "theme_strength": 50, "advanced": { "depth": 50, "motion": 50, "contrast": 50 } } },   "audio": { "...Audio Spec v1..." : true },   "preview": { "duration_sec": 10, "resolution": [1080,1920], "fps": 30 },   "export": { "duration_sec": 60, "resolution": [1080,1920], "fps": 30, "format": "mp4_h264_aac" } }`

### Audio Spec v1（要点）

- `audio.mode`: `"A" | "B" | "C"`
    
- `tone_solfeggio.hz`: 396/417/528/639/741/852（waveform=sine, dual_mono）
    
- `extra`
    
    - B：`type="binaural"`, `goal`, `carrier_hz(推奨200)`, `beat_hz(goalから自動)`
        
    - C：`type="schumann_binaural"`, `beat_hz=7.83`, `carrier_hz=200`
        
- `mixer`: `gain_mp3/gain_tone/gain_extra/gain_master` + `ducking`
    
- `safety`: limiter on, ceiling -1dB, extra gain cap
    

---

## 4) Binaural Goal → beat_hz（固定表）

- Sleep: 3.5
    
- Meditation: 6.0
    
- Relax: 10.0
    
- Focus: 16.0
    
- Peak: 40.0
    

---

## 5) MP3取り扱い（重要）

- MP3は任意。ある場合は **主役**（曲を壊さない）
    
- Export長 > MP3長：**自動ループ＋クロスフェード 1.5s固定**
    
- Preview segment：
    
    - Auto: 中盤30%から10秒
        
    - Pick: 任意開始秒
        

---

## 6) 保存/復元（MVP要件）

- Export時に必ず：
    
    - `*.mp4`
        
    - 同名の `*.json`（Project JSON＝完全復元）
        
- `.json`ドラッグ＆ドロップで復元
    
- MP3が見つからない場合：
    
    - 警告 + Re-link導線（MP3 OFFでも生成可能）
        

---

## 7) デモパック（同梱推奨）

- 4本：396(A), 528(B Focus), 741(A), 852(C)
    
- ファイル：
    
    - `demo_pack_expanded.json`（そのまま読める）
        
    - `demo_pack_merge.json`（defaults + $inherit、任意）
        
- UI：Demo Presets一覧 + Load + Preview + Run Demo 4 Pack（逐次生成）
    

---

## 8) Auto Review（プレビュー自動判定）

### 映像（軽量統計）

- loop_seam（先頭と末尾差）
    
- flicker95（平均輝度差分の95p）
    
- sat_hot_ratio（高彩度比）
    
- motion（連続差分平均）
    
- edge_density（Sobel等のエッジ比）
    

### 音（事故防止）

- true_peak_db（>0はFAIL）
    
- MP3主役比（Tone/Extraが近すぎたらWARN/FAIL）
    
- binauralの相関（stereo path検出）
    

### テーマ別最適化

- 396/852：motionとedge厳しめ
    
- 741：flicker/sat厳しめ
    
- 528：sat厳しめ、edgeは少し緩め …など
    

### suggestions（沼防止・最大2つ）

- Theme Strength ↓10 / Motion ↓10 / Contrast ↓10
    
- Tone ↓5 / Extra ↓5 / Master ↓10
    
- テーマ別優先順位で1〜2手のみ提示
    

---

## 9) 受け入れ（フェーズ順）

- Phase1：741で10秒ループ映像が自然
    
- Phase2：MP3+Toneミックスが成立（MP3主役）
    
- Phase3：B/C追加でも不快なし・extra cap有効
    
- Phase6：15/60/180秒Export安定＋サイドカーJSON＋復元OK
    

---

## 10) 実装インターフェース（UIからの呼び出し契約）

- `setProject(projectJson)`
    
- `generatePreview(projectJson) -> { videoUrl, meta, autoReview }`
    
- `exportFull(projectJson) -> { mp4Path, jsonPath }`
    
- `loadDemoPack() -> DemoPack`
    
- `runDemo4Pack() -> demoResults[]`
    

---

次はこのSpec v1を、**チケット（実装タスク）一覧**にして「Phase1→2→3→6」順に、各チケットのDone条件まで書き起こします。

はい

了解。では **実装チケット一覧（Phase1→2→3→6）**を、各チケットの **Done条件**つきで切ります。  
（これをそのままBacklogに貼れます）

---

# チケット一覧（AuraLoop Studio / Spec v1）

## Phase 0（共通土台）

### T0-1: Project JSONスキーマ確定＋バリデータ

**内容**

- `Project JSON v1` の型（video/audio/preview/export）確定
    
- 最低限のバリデーション（必須キー存在、数値範囲）  
    **Done**
    
- `validateProject(project)` が true/false を返す
    
- 不正JSONでもクラッシュせずエラー表示できる
    

### T0-2: 1画面UI骨格（Preview/Controls/Review）

**内容**

- Preview枠、Controls枠、Review枠
    
- ボタン：Generate Preview / Export（Exportはdisabled）  
    **Done**
    
- 画面が起動して操作可能
    
- 状態表示（Idle/Generating/Ready/Error）が出る
    

### T0-3: setProject()（唯一の状態反映口）

**内容**

- deep clone + Mode整合 + Reviewリセット + Export無効化
    
- MP3参照を引き継ぐオプション  
    **Done**
    
- Demo/復元/手動変更のどれでも setProject() を通す
    
- 反映漏れがない（UIが全項目更新される）
    

---

# Phase 1（映像10秒ループ成立）

### T1-1: Video Engine 最小実装（9:16 / 30fps）

**内容**

- Canvas/Three/ShaderのどれでもOK
    
- 1080×1920で描画  
    **Done**
    
- プレビュー枠でリアルタイム描画が動く
    
- FPSが極端に落ちない（目視でOK）
    

### T1-2: 10秒ループ時間管理（phase周期）

**内容**

- `phase = t / 10s` の周期制御
    
- ループが自然になる設計（乱数は循環 or seed固定）  
    **Done**
    
- 10秒終了→先頭に戻っても切れ目が目立たない
    

### T1-3: Preset 1本（741 Clear）実装

**内容**

- 霧（haze）＋粒子少量＋奥行き
    
- Theme Strengthがhaze量に効く（安全マッピング）  
    **Done**
    
- “霧が抜けて澄む”が分かる
    
- 点滅が主役にならない
    

### T1-4: Generate Preview（映像のみ）10秒生成・再生

**内容**

- 10秒分のレンダリング/録画/再生（方式は任意）  
    **Done**
    
- ボタン押下で10秒プレビューが再生できる
    
- 生成失敗時にUIが固まらない
    

---

# Phase 2（MP3 + Tone ミキサー）

### T2-1: MP3アップロード／Remove／再生

**内容**

- MP3読み込み、ファイル名/長さ表示
    
- Removeで解除  
    **Done**
    
- MP3 ON/OFFがUIで切替できる
    
- プレビュー再生ができる
    

### T2-2: Preview segment（Auto mid 30%）

**内容**

- Autoで中盤30%から10秒抜く
    
- MP3短い場合の扱い（無音 or 簡易ループ）  
    **Done**
    
- Autoで必ず10秒区間が取れる
    
- 短いMP3でも落ちない
    

### T2-3: Solfeggio Tone生成（dual_mono）

**内容**

- 正弦波（396/417/528/639/741/852）
    
- phase_lock（再生開始の違和感軽減）  
    **Done**
    
- Hz切替で音が変わる
    
- Tone Volume 0で消える
    

### T2-4: ミキサー（MP3/Tone/Master）＋Limiter

**内容**

- gain_mp3/gain_tone/gain_master
    
- limiter ceiling -1dB（簡易でもOK）  
    **Done**
    
- MP3が主役のままトーンが薄く入る（初期値で成立）
    
- Master100でも割れが頻発しない
    

### T2-5: 映像＋音で10秒プレビュー統合

**内容**

- `generatePreview(project)` が “音付き” を返す  
    **Done**
    
- 10秒映像と10秒音が同期して再生される
    
- 設定変更→再生成が反映される
    

---

# Phase 3（Extra：Binaural / Schumann）

### T3-1: Mode切替（A/B/C）とUI表示条件

**内容**

- BのみGoal表示
    
- B/CのみExtra Volume表示  
    **Done**
    
- 表示条件が仕様通り
    
- Mode切替で落ちない
    

### T3-2: Binaural生成（Goal 5種）

**内容**

- carrier 200Hz + beat（L/R差）
    
- Goal→beat_hz固定表  
    **Done**
    
- Goal切替で差が出る（薄い差でOK）
    
- 不快が出たらExtra Volumeで救える
    

### T3-3: Schumann生成（7.83固定）

**内容**

- beat 7.83、carrier 200、binaural_lr  
    **Done**
    
- Mode Cで動作
    
- Extra Volumeで薄く調整できる
    

### T3-4: Extra安全キャップ＋Ducking（推奨）

**内容**

- max_extra_gain_cap=20
    
- ducking（tone対象、amount 20）  
    **Done**
    
- Extra 100にしても事故が起きにくい
    
- MP3が主役のまま保たれる（Ducking ON）
    

---

# Phase 5（Review / ゲート）

### T5-1: Review UI（手動チェック＋結果）

**内容**

- Visual 8 + Theme 3 + Audio 3
    
- PASS/WARN/FAIL 表示  
    **Done**
    
- 状態が保存される（チェックが保持される）
    
- PASS時のみExport有効にできる
    

### T5-2: Auto Review v1（映像統計＋音統計）

**内容**

- loop_seam/flicker/sat/motion/edge
    
- true_peak / mp3主役比 / stereo相関
    
- テーマ別プロファイル適用  
    **Done**
    
- プレビュー後に自動でWARN/FAILが出せる
    
- suggestionsが最大2つ出る（沼らない）
    

---

# Phase 6（Export / 保存 / 復元）

### T6-1: Export 15秒（MP4出力）

**内容**

- 15s / 1080×1920 / 30fps / H.264+AAC（方式は任意）  
    **Done**
    
- MP4が再生できる
    
- 出力先に保存される
    

### T6-2: Export 60/180秒（安定化）

**内容**

- 長尺でも落ちない  
    **Done**
    
- 60s/180sが最後まで出力できる
    

### T6-3: MP3短い時のループ＋クロスフェード（1.5s固定）

**内容**

- Export長>MP3長で自動ループ
    
- クロスフェードで段差を隠す  
    **Done**
    
- つなぎ目が目立ちにくい
    
- 音量が跳ねない
    

### T6-4: サイドカーJSON自動保存（完全復元）

**内容**

- MP4と同名で`.json`保存  
    **Done**
    
- export後に必ずjsonが存在
    
- json→setProjectで復元できる
    

### T6-5: Open Project（json読み込み）＋MP3 re-link

**内容**

- json drag&drop または Open
    
- MP3 missing時の警告＋再指定  
    **Done**
    
- 100%設定復元（MP3は再指定で回復）
    
- missingでもクラッシュしない
    

---

# Demo（導線）

### TD-1: Demo Packローダー＋一覧UI

**内容**

- demo_pack_expanded.jsonを同梱し読み込み
    
- Demo Presets一覧（Load/Preview）  
    **Done**
    
- 4プリセットが表示されLoadできる
    

### TD-2: Run Demo 4 Pack（逐次プレビュー生成）

**内容**

- 4本を順番に10秒生成
    
- 進捗表示＋結果保持  
    **Done**
    
- demoResultsに4件揃う
    
- ユーザーが比較できる
    

---

## 最短の「まず答えが出る」マイルストーン

- **T1-1〜T1-4 + T2-1〜T2-5 + T6-1**  
    これで「10秒プレビュー（音付き）→15秒Export」で、完成物の質を即判定できます。